{"mappings":"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","sources":["node_modules/gamejs/src/gamejs.js","node_modules/gamejs/src/gamejs/math/matrix.js","node_modules/gamejs/src/gamejs/utils/objects.js","node_modules/gamejs/src/gamejs/utils/callback.js","node_modules/gamejs/src/gamejs/thread.js","node_modules/gamejs/src/gamejs/utils/uri.js","node_modules/gamejs/src/gamejs/event.js","node_modules/gamejs/src/gamejs/display.js","node_modules/gamejs/src/gamejs/graphics.js","node_modules/gamejs/src/gamejs/math/vectors.js","node_modules/gamejs/src/gamejs/math/angles.js","node_modules/gamejs/src/gamejs/font.js","node_modules/gamejs/src/gamejs/http.js","node_modules/gamejs/src/gamejs/image.js","node_modules/gamejs/src/gamejs/audio.js","node_modules/gamejs/src/gamejs/logging.js","node_modules/gamejs/src/gamejs/math/binaryheap.js","node_modules/gamejs/src/gamejs/math/random.js","node_modules/gamejs/src/gamejs/math/noise.js","node_modules/gamejs/src/gamejs/utils/arrays.js","node_modules/gamejs/src/gamejs/utils/strings.js","node_modules/gamejs/src/gamejs/utils/xml.js","node_modules/gamejs/src/gamejs/utils/base64.js","node_modules/gamejs/src/gamejs/pathfinding.js","node_modules/gamejs/src/gamejs/tiledmap.js","node_modules/gamejs/src/gamejs/time.js","node_modules/gamejs/src/gamejs/pixelcollision.js"],"sourcesContent":["var matrix = require('./gamejs/math/matrix');\nvar objects = require('./gamejs/utils/objects');\nvar Callback = require('./gamejs/utils/callback').Callback;\n\n/**\n * @fileoverview  `gamejs.ready()` is maybe the most important function as it kickstarts your app:\n *\n *     var gamejs = require('gamejs');\n *     ready(function() {\n *         gamejs.logging.info('I am ready!')\n *     });\n *\n * If you use images or sounds preload all assets with `gamejs.preload(['./files/foo.png'])` before calling `ready()`.\n *\n * Also in this module is the `Rect` class which is generally useful when dealing with Surfaces and simple rectangles (e.g. for collisions).\n */\n// preloading stuff\nvar gamejs = exports;\nvar RESOURCES = {};\n/**\n * @ignore\n */\nexports.thread = require('./gamejs/thread');\n\n\n/**\n * ReadyFn is called once all modules and assets are loaded.\n * @param {Function} callbackFunction the function to be called once gamejs finished loading\n * @name ready\n */\nif (gamejs.thread.inWorker === true) {\n   exports.ready = function(readyFn) {\n      require('./gamejs/thread')._ready();\n      gamejs.init();\n      readyFn();\n   };\n} else {\n   exports.ready = function(readyFn) {\n\n      var getMixerProgress = null;\n      var getImageProgress = null;\n\n      // init time instantly - we need it for preloaders\n      gamejs.time.init();\n\n      // 2.\n      function _ready() {\n         if (!document.body) {\n            return window.setTimeout(_ready, 50);\n         }\n         getImageProgress = gamejs.image.preload(RESOURCES);\n         try {\n            getMixerProgress = gamejs.audio.preload(RESOURCES);\n         } catch (e) {\n            gamejs.debug('Error loading audio files ', e);\n         }\n         window.setTimeout(_readyResources, 50);\n      }\n\n      // 3.\n      function _readyResources() {\n         if (getImageProgress() < 1 || getMixerProgress() < 1) {\n            return window.setTimeout(_readyResources, 100);\n         }\n         gamejs.display.init();\n         gamejs.image.init();\n         gamejs.audio.init();\n         gamejs.event.init();\n         gamejs.math.random.init();\n         readyFn();\n      }\n\n      // 1.\n      window.setTimeout(_ready, 13);\n\n      function getLoadProgress() {\n         if (getImageProgress) {\n            return (0.5 * getImageProgress()) + (0.5 * getMixerProgress());\n         }\n         return 0.1;\n      }\n\n      return getLoadProgress;\n   };\n}\n\n/**\n * Initialize all gamejs modules. This is automatically called\n * by `gamejs.ready()`.\n * @returns {Object} the properties of this objecte are the moduleIds that failed, they value are the exceptions\n * @ignore\n */\nexports.init = function() {\n   var errorModules = {};\n   ['time', 'display', 'image', 'audio', 'event'].forEach(function(moduleName) {\n      try {\n         gamejs[moduleName].init();\n      } catch (e) {\n         errorModules[moduleName] = e.toString();\n      }\n   });\n   return errorModules;\n};\n\nvar resourceBaseHref = function() {\n    return (window.$g && window.$g.resourceBaseHref) || document.location.href;\n};\n\n/**\n * Preload resources.\n * @param {Array} resources list of resources paths\n * @name preload\n */\nvar preload = exports.preload = function(resources) {\n   var uri = require('./gamejs/utils/uri');\n   var baseHref = resourceBaseHref();\n   resources.forEach(function(res) {\n      RESOURCES[res] = uri.resolve(baseHref, res);\n   }, this);\n   return;\n};\n\n/**\n * The function passed to `onTick` will continously be called at a\n * frequency determined by the browser (typically between 1 and 60 times per second).\n * @param {Function} callbackFunction the function you want to be called\n * @param {Function} callbackScope optional scope for the function call\n */\nexports.onTick = function(fn, scope) {\n  /** ignore **/\n  exports.time._CALLBACKS.push(new Callback(fn, scope));\n};\n\n/**\n * Normalize various ways to specify a Rect into {left, top, width, height} form.\n * @ignore\n *\n */\nvar normalizeRectArguments = exports.normalizeRectArguments = function () {\n   var left = 0;\n   var top = 0;\n   var width = 0;\n   var height = 0;\n\n   if (arguments.length === 2) {\n      if (arguments[0] instanceof Array && arguments[1] instanceof Array) {\n         left = arguments[0][0];\n         top = arguments[0][1];\n         width = arguments[1][0];\n         height = arguments[1][1];\n      } else {\n         left = arguments[0];\n         top = arguments[1];\n      }\n   } else if (arguments.length === 1 && arguments[0] instanceof Array) {\n      left = arguments[0][0];\n      top = arguments[0][1];\n      width = arguments[0][2];\n      height = arguments[0][3];\n   } else if (arguments.length === 1 && arguments[0] instanceof Rect) {\n      left = arguments[0].left;\n      top = arguments[0].top;\n      width = arguments[0].width;\n      height = arguments[0].height;\n   } else if (arguments.length === 4) {\n      left = arguments[0];\n      top = arguments[1];\n      width = arguments[2];\n      height = arguments[3];\n   } else {\n      throw new Error('not a valid rectangle specification');\n   }\n   return {left: left || 0, top: top || 0, width: width || 0, height: height || 0};\n};\n\n\n/**\n * Creates a Rect. Rects are used to hold rectangular areas. There are a couple\n * of convinient ways to create Rects with different arguments and defaults.\n *\n * Any function that requires a `gamejs.Rect` argument also accepts any of the\n * constructor value combinations `Rect` accepts.\n *\n * Rects are used a lot. They are good for collision detection, specifying\n * an area on the screen (for blitting) or just to hold an objects position.\n *\n * The Rect object has several virtual attributes which can be used to move and align the Rect:\n *\n *   top, left, bottom, right\n *   topleft, bottomleft, topright, bottomright\n *   center\n *   width, height\n *   w,h\n *\n * All of these attributes can be assigned to.\n * Assigning to width or height changes the dimensions of the rectangle; all other\n * assignments move the rectangle without resizing it. Notice that some attributes\n * are Numbers and others are pairs of Numbers.\n *\n * @example\n * new Rect([left, top]) // width & height default to 0\n * new Rect(left, top) // width & height default to 0\n * new Rect(left, top, width, height)\n * new Rect([left, top], [width, height])\n * new Rect(oldRect) // clone of oldRect is created\n *\n * @property {Number} right\n * @property {Number} bottom\n * @property {Number} center\n * @constructor\n * @param {Array|gamejs.Rect} position Array holding left and top coordinates\n * @param {Array} dimensions Array holding width and height\n */\nvar Rect = exports.Rect = function() {\n\n   var args = normalizeRectArguments.apply(this, arguments);\n\n   /**\n    * Left, X coordinate\n    * @type Number\n    */\n   this.left = args.left;\n\n   /**\n    * Top, Y coordinate\n    * @type Number\n    */\n   this.top = args.top;\n\n   /**\n    * Width of rectangle\n    * @type Number\n    */\n   this.width = args.width;\n\n   /**\n    * Height of rectangle\n    * @type Number\n    */\n   this.height = args.height;\n\n   return this;\n};\n\nobjects.accessors(Rect.prototype, {\n   /**\n    * Bottom, Y coordinate\n    * @name Rect.prototype.bottom\n    * @type Number\n    */\n   'bottom': {\n      get: function() {\n         return this.top + this.height;\n      },\n      set: function(newValue) {\n         this.top = newValue - this.height;\n         return;\n      }\n   },\n   /**\n    * Right, X coordinate\n    * @name Rect.prototype.right\n    * @type Number\n    */\n   'right': {\n      get: function() {\n         return this.left + this.width;\n      },\n      set: function(newValue) {\n         this.left = newValue - this.width;\n      }\n   },\n   /**\n    * Center Position. You can assign a rectangle form.\n    * @name Rect.prototype.center\n    * @type Array\n    */\n   'center': {\n      get: function() {\n         return [this.left + (this.width / 2) | 0,\n                 this.top + (this.height / 2) | 0\n                ];\n      },\n      set: function() {\n         var args = normalizeRectArguments.apply(this, arguments);\n         this.left = args.left - (this.width / 2) | 0;\n         this.top = args.top - (this.height / 2) | 0;\n         return;\n      }\n   },\n   /**\n    * Top-left Position. You can assign a rectangle form.\n    * @name Rect.prototype.topleft\n    * @type Array\n    */\n   'topleft': {\n      get: function() {\n         return [this.left, this.top];\n      },\n      set: function() {\n         var args = normalizeRectArguments.apply(this, arguments);\n         this.left = args.left;\n         this.top = args.top;\n         return;\n      }\n   },\n   /**\n    * Bottom-left Position. You can assign a rectangle form.\n    * @name Rect.prototype.bottomleft\n    * @type Array\n    */\n   'bottomleft': {\n      get: function() {\n         return [this.left, this.bottom];\n      },\n      set: function() {\n         var args = normalizeRectArguments.apply(this, arguments);\n         this.left = args.left;\n         this.bottom = args.top;\n         return;\n      }\n   },\n   /**\n    * Top-right Position. You can assign a rectangle form.\n    * @name Rect.prototype.topright\n    * @type Array\n    */\n   'topright': {\n      get: function() {\n         return [this.right, this.top];\n      },\n      set: function() {\n         var args = normalizeRectArguments.apply(this, arguments);\n         this.right = args.left;\n         this.top = args.top;\n         return;\n      }\n   },\n   /**\n    * Bottom-right Position. You can assign a rectangle form.\n    * @name Rect.prototype.bottomright\n    * @type Array\n    */\n   'bottomright': {\n      get: function() {\n         return [this.right, this.bottom];\n      },\n      set: function() {\n         var args = normalizeRectArguments.apply(this, arguments);\n         this.right = args.left;\n         this.bottom = args.top;\n         return;\n      }\n   },\n   /**\n    * Position x value, alias for `left`.\n    * @name Rect.prototype.y\n    * @type Array\n    */\n   'x': {\n      get: function() {\n         return this.left;\n      },\n      set: function(newValue) {\n         this.left = newValue;\n         return;\n      }\n   },\n   /**\n    * Position y value, alias for `top`.\n    * @name Rect.prototype.y\n    * @type Array\n    */\n   'y': {\n      get: function() {\n         return this.top;\n      },\n      set: function(newValue) {\n         this.top = newValue;\n         return;\n      }\n   }\n});\n\n/**\n * Move returns a new Rect, which is a version of this Rect\n * moved by the given amounts. Accepts any rectangle form.\n * as argument.\n *\n * @param {Number|gamejs.Rect} x amount to move on x axis\n * @param {Number} y amount to move on y axis\n */\nRect.prototype.move = function() {\n   var args = normalizeRectArguments.apply(this, arguments);\n   return new Rect(this.left + args.left, this.top + args.top, this.width, this.height);\n};\n\n/**\n * Move this Rect in place - not returning a new Rect like `move(x, y)` would.\n *\n * `moveIp(x,y)` or `moveIp([x,y])`\n *\n * @param {Number|gamejs.Rect} x amount to move on x axis\n * @param {Number} y amount to move on y axis\n */\nRect.prototype.moveIp = function() {\n   var args = normalizeRectArguments.apply(this, arguments);\n   this.left += args.left;\n   this.top += args.top;\n   return;\n};\n\n/**\n * Return the area in which this Rect and argument Rect overlap.\n *\n * @param {gamejs.Rect} Rect to clip this one into\n * @returns {gamejs.Rect} new Rect which is completely inside the argument Rect,\n * zero sized Rect if the two rectangles do not overlap\n */\nRect.prototype.clip = function(rect) {\n   if(!this.collideRect(rect)) {\n      return new Rect(0,0,0,0);\n   }\n\n   var x, y, width, height;\n\n   // Left\n   if ((this.left >= rect.left) && (this.left < rect.right)) {\n      x = this.left;\n   } else if ((rect.left >= this.left) && (rect.left < this.right)) {\n      x = rect.left;\n   }\n\n   // Right\n   if ((this.right > rect.left) && (this.right <= rect.right)) {\n      width = this.right - x;\n   } else if ((rect.right > this.left) && (rect.right <= this.right)) {\n      width = rect.right - x;\n   }\n\n   // Top\n   if ((this.top >= rect.top) && (this.top < rect.bottom)) {\n      y = this.top;\n   } else if ((rect.top >= this.top) && (rect.top < this.bottom)) {\n      y = rect.top;\n   }\n\n   // Bottom\n   if ((this.bottom > rect.top) && (this.bottom <= rect.bottom)) {\n     height = this.bottom - y;\n   } else if ((rect.bottom > this.top) && (rect.bottom <= this.bottom)) {\n     height = rect.bottom - y;\n   }\n   return new Rect(x, y, width, height);\n};\n\n/**\n * Join two rectangles\n *\n * @param {gamejs.Rect} union with this rectangle\n * @returns {gamejs.Rect} rectangle containing area of both rectangles\n */\nRect.prototype.union = function(rect) {\n   var x, y, width, height;\n\n   x = Math.min(this.left, rect.left);\n   y = Math.min(this.top, rect.top);\n   width = Math.max(this.right, rect.right) - x;\n   height = Math.max(this.bottom, rect.bottom) - y;\n   return new Rect(x, y, width, height);\n};\n\n/**\n * Grow or shrink the rectangle size\n *\n * @param {Number} amount to change in the width\n * @param {Number} amount to change in the height\n * @returns {gamejs.Rect} inflated rectangle centered on the original rectangle's center\n */\nRect.prototype.inflate = function(x, y) {\n    var copy = this.clone();\n\n    copy.inflateIp(x, y);\n\n    return copy;\n};\n\n/**\n * Grow or shrink this Rect in place - not returning a new Rect like `inflate(x, y)` would.\n *\n * @param {Number} amount to change in the width\n * @param {Number} amount to change in the height\n */\nRect.prototype.inflateIp = function(x, y) {\n    // Use Math.floor here to deal with rounding of negative numbers the\n    // way this relies on.\n    this.left -= Math.floor(x / 2);\n    this.top -= Math.floor(y / 2);\n    this.width += x;\n    this.height += y;\n};\n\n/**\n * Check for collision with a point.\n *\n * `collidePoint(x,y)` or `collidePoint([x,y])` or `collidePoint(new Rect(x,y))`\n *\n * @param {Array|gamejs.Rect} point the x and y coordinates of the point to test for collision\n * @returns {Boolean} true if the point collides with this Rect\n */\nRect.prototype.collidePoint = function() {\n   var args = normalizeRectArguments.apply(this, arguments);\n   return (this.left <= args.left && args.left <= this.right) &&\n       (this.top <= args.top && args.top <= this.bottom);\n};\n\n/**\n * Check for collision with a Rect.\n * @param {gamejs.Rect} rect the Rect to test check for collision\n * @returns {Boolean} true if the given Rect collides with this Rect\n */\nRect.prototype.collideRect = function(rect) {\n   return !(this.left > rect.right || this.right < rect.left ||\n      this.top > rect.bottom || this.bottom < rect.top);\n};\n\n/**\n * @param {Array} pointA start point of the line\n * @param {Array} pointB end point of the line\n * @returns true if the line intersects with the rectangle\n * @see http://stackoverflow.com/questions/99353/how-to-test-if-a-line-segment-intersects-an-axis-aligned-rectange-in-2d/293052#293052\n *\n */\nRect.prototype.collideLine = function(p1, p2) {\n   var x1 = p1[0];\n   var y1 = p1[1];\n   var x2 = p2[0];\n   var y2 = p2[1];\n\n   function linePosition(point) {\n      var x = point[0];\n      var y = point[1];\n      return (y2 - y1) * x + (x1 - x2) * y + (x2 * y1 - x1 * y2);\n   }\n\n   var relPoses = [[this.left, this.top],\n                   [this.left, this.bottom],\n                   [this.right, this.top],\n                   [this.right, this.bottom]\n                  ].map(linePosition);\n\n   var noNegative = true;\n   var noPositive = true;\n   var noZero = true;\n   relPoses.forEach(function(relPos) {\n      if (relPos > 0) {\n         noPositive = false;\n      } else if (relPos < 0) {\n         noNegative = false;\n      } else if (relPos === 0) {\n         noZero = false;\n      }\n   }, this);\n\n   if ( (noNegative || noPositive) && noZero) {\n      return false;\n   }\n   return !((x1 > this.right && x2 > this.right) ||\n            (x1 < this.left && x2 < this.left) ||\n            (y1 < this.top && y2 < this.top) ||\n            (y1 > this.bottom && y2 > this.bottom)\n            );\n};\n\n/**\n * @returns {String} Like \"[x, y][w, h]\"\n */\nRect.prototype.toString = function() {\n   return [\"[\", this.left, \",\", this.top, \"]\",\" [\",this.width, \",\", this.height, \"]\"].join(\"\");\n};\n\n/**\n * @returns {gamejs.Rect} A new copy of this rect\n */\nRect.prototype.clone = function() {\n   return new Rect(this);\n};\n\n/**\n * @ignore\n */\nexports.event = require('./gamejs/event');\n/**\n * @ignore\n */\nexports.font = require('./gamejs/font');\n/**\n * @ignore\n */\nexports.http = require('./gamejs/http');\n/**\n * @ignore\n */\nexports.image = require('./gamejs/image');\n/**\n * @ignore\n */\nexports.audio = require('./gamejs/audio');\n/**\n * @ignore\n */\nexports.graphics = require('./gamejs/graphics');\n\n/**\n * @ignore\n */\nexports.logging = require('./gamejs/logging');\n\n/**\n * @ignore\n */\nexports.math = {\n   matrix: require('./gamejs/math/matrix'),\n   vectors: require('./gamejs/math/vectors'),\n   angles: require('./gamejs/math/angles'),\n   binaryheap: require('./gamejs/math/binaryheap'),\n   random: require('./gamejs/math/random'),\n   noise: require('./gamejs/math/noise'),\n};\n\n/**\n * @ignore\n */\nexports.utils = {\n   arrays: require('./gamejs/utils/arrays'),\n   objects: require('./gamejs/utils/objects'),\n   uri: require('./gamejs/utils/uri'),\n   strings: require('./gamejs/utils/strings'),\n   xml: require('./gamejs/utils/xml'),\n   base64: require('./gamejs/utils/base64')\n};\n/**\n * @ignore\n */\nexports.display = require('./gamejs/display');\n/**\n * @ignore\n */\nexports.pathfinding = require('./gamejs/pathfinding');\n\n\n/**\n * @ignore\n */\nexports.tiledmap = require('./gamejs/tiledmap');\n\n\n/**\n * @ignore\n */\nexports.time = require('./gamejs/time');\n\n/**\n * @ignore\n */\nexports.pixelcollision = require('./gamejs/pixelcollision');","/**\n * @fileoverview Matrix manipulation, used by GameJs itself. You\n * probably do not need this unless you manipulate a Context's transformation\n * matrix yourself.\n */\n\n// correct way to do scale, rotate, translate\n// *  gamejs.utils.matrix will be used in gamejs.transforms, modifing the surfaces.matrix\n// * this matrix must be applied to the context in Surface.draw()\n\n/**\n * @returns {Array} [1, 0, 0, 1, 0, 0]\n */\nvar identiy = exports.identity = function () {\n   return [1, 0, 0, 1, 0, 0];\n};\n\n/**\n * @param {Array} matrix\n * @param {Array} matrix\n * @returns {Array} matrix sum\n */\nvar add = exports.add = function(m1, m2) {\n   return [\n      m1[0] + m2[0],\n      m1[1] + m2[1],\n      m1[2] + m2[2],\n      m1[3] + m2[3],\n      m1[4] + m2[4],\n      m1[5] + m2[5],\n      m1[6] + m2[6]\n   ];\n};\n\n/**\n * @param {Array} matrix A\n * @param {Array} matrix B\n * @returns {Array} matrix product\n */\nvar multiply = exports.multiply = function(m1, m2) {\n   return [\n      m1[0] * m2[0] + m1[2] * m2[1],\n      m1[1] * m2[0] + m1[3] * m2[1],\n      m1[0] * m2[2] + m1[2] * m2[3],\n      m1[1] * m2[2] + m1[3] * m2[3],\n      m1[0] * m2[4] + m1[2] * m2[5] + m1[4],\n      m1[1] * m2[4] + m1[3] * m2[5] + m1[5]\n   ];\n};\n\n/**\n * @param {Array} matrix\n * @param {Number} dx\n * @param {Number} dy\n * @returns {Array} translated matrix\n */\nvar translate = exports.translate = function(m1, dx, dy) {\n   return multiply(m1, [1, 0, 0, 1, dx, dy]);\n};\n\n/**\n * @param {Array} matrix\n * @param {Number} angle in radians\n * @returns {Array} rotated matrix\n */\nvar rotate = exports.rotate = function(m1, angle) {\n   // radians\n   var sin = Math.sin(angle);\n   var cos = Math.cos(angle);\n   return multiply(m1, [cos, sin, -sin, cos, 0, 0]);\n};\n\n/**\n * @param {Array} matrix\n * @returns {Number} rotation in radians\n */\nvar rotation = exports.rotation = function(m1) {\n      return Math.atan2(m1[1], m1[0]);\n};\n\n/**\n * @param {Array} matrix\n * @param {Array} vector [a, b]\n * @returns {Array} scaled matrix\n */\nvar scale = exports.scale = function(m1, svec) {\n   var sx = svec[0];\n   var sy = svec[1];\n   return multiply(m1, [sx, 0, 0, sy, 0, 0]);\n};\n","/**\n * @fileoverview Utility functions for working with Objects\n */\n\n/**\n * Put a prototype into the prototype chain of another prototype.\n * @param {Object} subClass\n * @param {Object} superClass\n */\nexports.extend = function(subClass, superClass) {\n   if (subClass === undefined) {\n      throw new Error('unknown subClass');\n   }\n   if (superClass === undefined) {\n      throw new Error('unknown superClass');\n   }\n   var F;\n   /* jshint ignore:start */\n   F = new Function();\n   /* jshint ignore:start */\n   F.prototype = superClass.prototype;\n   /* jshint ignore:end */\n   subClass.prototype = new F();\n   subClass.prototype.constructor = subClass;\n   subClass.superClass = superClass.prototype;\n   subClass.superConstructor = superClass;\n   return;\n};\n\n/**\n * Creates a new object as the as the keywise union of the provided objects.\n * Whenever a key exists in a later object that already existed in an earlier\n * object, the according value of the earlier object takes precedence.\n * @param {Object} obj... The objects to merge\n */\nexports.merge = function() {\n   var result = {};\n   var i, property;\n      for (i = arguments.length; i > 0; --i) {\n         var obj = arguments[i - 1];\n         for (property in obj) {\n            result[property] = obj[property];\n         }\n      }\n   return result;\n};\n\n/**\n * fallback for Object.keys\n * @param {Object} obj\n * @returns {Array} list of own properties\n * @see https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/Object/keys\n */\nvar keys = exports.keys = function(obj) {\n   if (Object.keys) {\n      return Object.keys(obj);\n   }\n\n   var ret=[],p;\n   for (p in obj) {\n      if(Object.prototype.hasOwnProperty.call(obj, p)) {\n         ret.push(p);\n      }\n   }\n   return ret;\n};\n\n/**\n * Create object accessors\n * @param {Object} object The object on which to define the property\n * @param {String} name name of the property\n * @param {Function} get\n * @param {Function} set\n * @see https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/Object/defineProperty\n */\nvar accessor = exports.accessor = function(object, name, get, set) {\n   // ECMA5\n   if (Object.defineProperty !== undefined) {\n      Object.defineProperty(object, name, {\n         get: get,\n         set: set\n      });\n   // non-standard\n   } else if (Object.prototype.__defineGetter__ !== undefined) {\n      object.__defineGetter__(name, get);\n      if (set) {\n         object.__defineSetter__(name, set);\n      }\n   }\n\treturn;\n};\n\n/**\n * @param {Object} object The object on which to define or modify properties.\n * @param {Object} props An object whose own enumerable properties constitute descriptors for the properties to be defined or modified.\n * @see https://developer.mozilla.org/en/JavaScript/Reference/Global_Objects/Object/defineProperties\n */\nexports.accessors = function(object, props) {\n   keys(props).forEach(function(propKey) {\n      accessor(object, propKey, props[propKey].get, props[propKey].set);\n   });\n   return;\n};\n","/**\n * @fileoverview\n * Manage a callback with invocation scope. This is used internally by GameJs but might be useful for others.\n */\n\n/**\n * @param {Function} callback\n * @param {Object} scope with which the callback will be triggered\n */\nvar Callback = exports.Callback = function(fn, scope) {\n\tthis.fn = fn;\n\tthis.fnScope = scope || {};\n\treturn this;\n};\n/**\n * Any arguments passed to `trigger` will be passed to the callback.\n */\nCallback.prototype.trigger = function() {\n\tthis.fn.apply(this.fnScope, arguments);\n};","var gamejs = require('../gamejs');\nvar uri = require('./utils/uri');\nvar Callback = require('./utils/callback').Callback;\n\n/**\n * ignore\n */\nvar _EVENTS = exports._EVENTS = {\n   RESULT: 1001,\n   ALIVE: 1002,\n   LOG: 1004\n};\n\n/**\n * @fileoverview\n *\n * gamejs.worker makes it more convinient to work with W3C WebWorkers by providing a way to run\n * CommonJs modules inside of them. GameJs also provides the typically `gamejs.ready()` and\n * event loop to facilitate communication between workers and the main application.\n *\n * See the `examples/workers` directory for a running example.\n *\n * Create a worker with the main module \"foo-worker\" (see below for how the worker's module looks like):\n *\n *     var fooWorker = new Worker('./foo-worker');\n *     // Send a message to your worker.\n *     // The Message doesn't have to be a string but it\n *     // must be `JSON.stringify()`-able\n *     fooWorker.post(\"foobar\");\n *\n * You can also recieve messages from the worker:\n *\n *     // recieve events from the worker\n *     fooWorker.onEvent(function(event) {\n *         if(event.timestamp > ...)\n *      });\n *\n * And this is how the above referenced \"foo-worker\" module would looke like. As usual, we need a\n * `gamejs.ready()` to get started and within that we bind an event handler:\n *\n *     var gamejs = require('gamejs');\n *     gamejs.ready(function() {\n *         gamejs.event.onEvent(function(event) {\n *              var plaintext = fastCrack(event.password)\n *              ....\n *          });\n *     });\n *\n * Our event worker could do expensive calculations (seperate and not blocking the main game) when\n * recieving an event. Once the result is caculated, it can be sent back to the main application\n * with `gamejs.thread.post()`:\n *\n *     gamejs.thread.post({\n *        info: \"important message from worker\",\n *        timestamp: 12232435234\n *      });\n *\n * The main application would in turn recieve an event posted like this from `fooWorker.onEvent`, as seen above.\n *\n * This module is useful for expensive algorithms where the result does not have to available instantiously\n * (e.g., path-finding) or for continous logic which can be\n * calculated seperately from the rendering loop, and which only needs to feed back into the model of the rendering every\n * now and then (e.g. physics) The main draw back of the `Worker` model is that\n * you can only communicate with them via text messages (typically JSON.stringify()ed messages).\n */\n\n/**\n * true if this GameJs instance is being executed within a WebWorker\n * @type Boolean\n */\nvar inWorker = exports.inWorker = (this.importScripts !== undefined);\n\n/**\n * executed in scope of worker\n * @ignore\n */\nexports._ready = function() {\n   self.onmessage = function(event) {\n      gamejs.event._triggerCallbacks(event.data);\n   };\n   self.postMessage({\n     type: _EVENTS.ALIVE\n   });\n};\n\n/**\n * Send an event back to the main script.\n * @param {Object} data to be sent back to main script\n */\nexports.post = function(data) {\n  if (inWorker) {\n    self.postMessage({\n       type: _EVENTS.RESULT,\n       data: data\n    });\n  } else {\n    throw new Error('gamejs.postMessage only available in a thread/worker module');\n  }\n};\n\n/**\n * Send message to main context for logging\n * @ignore\n **/\nexports._logMessage = function() {\n   var args = [];\n   Array.prototype.forEach.call(arguments, function(a) {\n     args.push(a);\n   });\n   self.postMessage({\n      type: _EVENTS.LOG,\n      arguments: args\n   });\n};\n\n\n/**\n  * executed in scope of worker before user's main module\n  * @ignore\n  */\nvar workerPrefix = function workerPrefix() {\n   __scripts.forEach(function(script) {\n      try {\n         importScripts(script);\n      } catch (e) {\n         // can't help the worker\n      }\n   });\n};\n\n/**\n * Setup a worker which has `require()` defined\n * @ignore\n **/\nvar create = function(workerModuleId) {\n   var moduleRoot = uri.resolve(document.location.href, window.require.getModuleRoot());\n   var initialScripts = [];\n   Array.prototype.slice.apply(document.getElementsByTagName('script'), [0]).forEach(function(script) {\n      if (script.src) {\n         initialScripts.push(script.src);\n      }\n   });\n\n   var URL = window.URL || window.webkitURL;\n   var prefixString = workerPrefix.toString();\n   // don't be afraid...\n   prefixString = prefixString.substring(prefixString.indexOf(\"{\") + 1, prefixString.lastIndexOf(\"}\"));\n   var blob = new Blob([\n      'var __scripts = [\"' + initialScripts.join('\",\"') + '\"];',\n      prefixString,\n      ';self.require.setModuleRoot(\"' + moduleRoot + '\");',\n      'self.require.run(\"'+ workerModuleId +'\");'\n   ], {type: 'application\\/javascript'});\n\n   var blobURL = URL.createObjectURL(blob);\n   return new Worker(blobURL);\n};\n\n/**\n * The `Worker` constructor takes only one argument: a module id. This module\n * will be executed inside the newly created Worker. It is effectively the\n * main module of the Worker.\n *\n * Inside a Worker, you can use `require()` to import other scripts or\n * GameJs modules.\n *\n * **Note:** A Worker does not have access to the browser's `document`. So\n * a lot of GameJs modules - everything related to drawing to the canvas -\n * do not work in the Worker.\n *\n * You can use `gamejs.time.*`, `gamejs.utils.*`, `gamejs.event.*` and probably others\n * (as well as any module you write yourself for this purpose, of course).\n *\n * @param {String} moduleId The Worker's main module id. The main module will be executed in the worker\n */\nexports.Worker = function(moduleId) {\n   // FIXME id should be unchangeable\n   /**\n    * Unique id of this worker\n    * @property {Number}\n    */\n   var id = this.id = guid(moduleId);\n   var worker = create(moduleId);\n   var deadQueue = [];\n   var alive = false;\n   var self  = this;\n   var _CALLBACKS = [];\n   var _ERROR_CALLBACKS = [];\n\n   function triggerCallbacks(callbacks, event) {\n      callbacks.forEach(function(c) {\n         c.trigger(event);\n      });\n   }\n\n   worker.onmessage = function(event) {\n      if (event.data.type === _EVENTS.ALIVE) {\n         // if worker says he is alive -> send him the event queue so far\n         alive = true;\n         deadQueue.forEach(function(data) {\n            self.post(data);\n         });\n      } else if (event.data.type === _EVENTS.LOG) {\n         gamejs.logging.log.apply(null, [id].concat(event.data.arguments));\n      } else {\n         triggerCallbacks(_CALLBACKS, event.data.data);\n      }\n   };\n   worker.onerror = function(event) {\n      gamejs.logging.error('Error in worker \"' + id + '\" line ' + event.lineno + ': ', event.message);\n      triggerCallbacks(_ERROR_CALLBACKS, {\n         data: event.data,\n         worker: self,\n         event: event\n      });\n   };\n\n   this.onEvent = function(fn, scope) {\n      _CALLBACKS.push(new Callback(fn, scope));\n   };\n\n   this.onError = function(fn, scope) {\n      _ERROR_CALLBACKS.push(new Callback(fn, scope));\n   };\n\n   /**\n    * Send a message to the worker\n    *\n    * @param {Object} data Payload object which gets sent to the Worker\n    */\n   this.post = function(data) {\n      if (alive) {\n         worker.postMessage(data);\n      } else {\n         deadQueue.push(data);\n      }\n   };\n   return this;\n};\n\n/**\n * not a real GUID\n * @ignore\n */\nfunction guid(moduleId) {\n   var S4 = function() {\n      return (((1+Math.random())*0x10000)|0).toString(16).substring(1);\n   };\n   return moduleId + '@' + (S4()+S4());\n}","/**\n * @fileoverview Utilies for URI handling.\n *\n */\n\nvar URI_REGEX = new RegExp(\n    '^' +\n    '(?:' +\n      '([^:/?#.]+)' +                     // scheme - ignore special characters\n                                          // used by other URL parts such as :,\n                                          // ?, /, #, and .\n    ':)?' +\n    '(?://' +\n      '(?:([^/?#]*)@)?' +                 // userInfo\n      '([\\\\w\\\\d\\\\-\\\\u0100-\\\\uffff.%]*)' + // domain - restrict to letters,\n                                          // digits, dashes, dots, percent\n                                          // escapes, and unicode characters.\n      '(?::([0-9]+))?' +                  // port\n    ')?' +\n    '([^?#]+)?' +                         // path\n    '(?:\\\\?([^#]*))?' +                   // query\n    '(?:#(.*))?' +                        // fragment\n    '$');\n\n/**\n * Resolve path against URI.\n *\n * @param {String} uri\n * @param {String} path to resolve\n */\nvar resolve = exports.resolve = function(uri, path) {\n   var m = match(uri);\n   var n = match(path);\n   var host = m[1] + '://' + m[3];\n   if (n[1]) {\n      return path;\n   }\n   if (m[4]) {\n      host = host + \":\" + m[4];\n   }\n   var absolutePath = m[5];\n   if (path.charAt(0) !== '/') {\n      var lastSlashIndex = absolutePath.lastIndexOf('/');\n      absolutePath = absolutePath.substr(0, lastSlashIndex + 1) + path;\n   } else {\n      absolutePath = path;\n   }\n   return host + removeDotSegments(absolutePath);\n\n};\n\n/**\n * Try to match an URI against a regex returning the following\n * capture groups:\n *     $1 = http              scheme\n *     $2 = <undefined>       userInfo -\\\n *     $3 = www.ics.uci.edu   domain     | authority\n *     $4 = <undefined>       port     -/\n *     $5 = /pub/ietf/uri/    path\n *     $6 = <undefined>       query without ?\n *     $7 = Related           fragment without #\n *\n * @param {String} uri\n */\nvar match = exports.match = function(uri) {\n   return uri.match(URI_REGEX);\n};\n\n/**\n * Make an absolute URI relative to document.location.href\n * @param {String} uri\n * @returns The relative URI or the unchanged URI if it's not\n * possible to make it relative to the path of document.location.href.\n */\nvar makeRelative = exports.makeRelative = function(uri) {\n   var docLocPath = resolve(document.location.href, './');\n   if (uri.indexOf(docLocPath) === 0) {\n      uri = './' + uri.substring(docLocPath.length);\n   }\n   return uri;\n};\n\n/**\n * Removes dot segments in given path component\n */\nvar removeDotSegments = function(path) {\n   if (path == '..' || path == '.') {\n      return '';\n   }\n   var leadingSlash = path.indexOf('/') > -1;\n\n   var segments = path.split('/');\n   var out = [];\n\n   var pos;\n   for (pos = 0; pos < segments.length; ) {\n      var segment = segments[pos++];\n\n      if (segment == '.') {\n         if (leadingSlash && pos == segments.length) {\n            out.push('');\n         }\n      } else if (segment == '..') {\n         if (out.length > 1 || out.length !== 1 && out[0] !== '') {\n            out.pop();\n         }\n         if (leadingSlash && pos == segments.length) {\n            out.push('');\n         }\n      } else {\n         out.push(segment);\n         leadingSlash = true;\n      }\n   }\n   return out.join('/');\n};\n","var display = require('./display');\nvar Callback = require('./utils/callback').Callback;\n\n/**\n * @fileoverview\n * Deal with mouse and keyboard events.\n *\n * You can either handle all events in one callback with `gamejs.event.onEvent()`:\n *\n *     gamejs.onEvent(function(event) {\n *        if (event.type === gamejs.event.MOUSE_UP) {\n *          gamejs.logging.info(event.pos, event.button);\n *        } else if (event.type === gamejs.event.KEY_UP) {\n *          gamejs.logging.info(event.key);\n *        }\n *     });\n *\n * Or recieve more specific callbacks, e.g. only for `KEY\\_UP` with  `gamejs.event.onKeyUp()`:\n *\n *     gamejs.onKeyUp(function(event) {\n *          gamejs.logging.info(event.key);\n *     });\n *\n * All events passed to your callback are instances of `gamejs.event.Event` and have a `type` property to help\n * you distinguish between the different events. This `type` property is set to one of those constants:\n *\n *  * gamejs.event.MOUSE\\_UP\n *  * gamejs.event.MOUSE\\_MOTION\n *  * gamejs.event.MOUSE\\_DOWN\n *  * gamejs.event.KEY\\_UP\n *  * gamejs.event.KEY\\_DOWN\n *  * gamejs.event.DISPLAY\\_FULLSCREEN\\_ENABLED\n *  * gamejs.event.DISPLAY\\_FULLSCREEN\\_DISABLED\n *  * gamejs.event.QUIT\n *  * gamejs.event.MOUSE_WHEEL\n *  * gamejs.event.TOUCH\\_DOWN\n *  * gamejs.event.TOUCH\\_UP\n *  * gamejs.event.TOUCH\\_MOTION\n *\n * ### Keyboard constants\n *\n * There are also a lot of keyboard constants for ASCII. Those are all prefixed with `K\\_`, e.g. `gamejs.event.K\\_a` would be the \"a\"\n * key and `gamejs.event.K_SPACE` is the spacebar.\n *\n * ## Touch events\n *\n * Touch events do not have a single position but for all `TOUCH\\_*` events you get an array of\n * `touches`, which each have their own `pos` attribute and a unique `identifier` for tracking\n * this touch across multiple `TOUCH\\_MOTION` events.\n *\n * ## User defined events\n *\n * All user defined events can have the value of `gamejs.event.USEREVENT` or higher.\n * Make sure your custom event ids follow this system.\n *\n * @example\n *     gamejs.onEvent(function(event) {\n *        if (event.type === gamejs.event.MOUSE_UP) {\n *          gamejs.logging.log(event.pos, event.button);\n *        } else if (event.type === gamejs.event.KEY_UP) {\n *          gamejs.logging.log(event.key);\n *        }\n *     });\n *\n */\n\nvar _CALLBACKS = [];\n\n/** @ignore **/\nvar _triggerCallbacks = exports._triggerCallbacks = function() {\n  var args = arguments;\n  _CALLBACKS.forEach(function(cb) {\n    if (cb.type === 'all' || args[0].type === cb.type) {\n      cb.callback.apply(cb.scope, args);\n    }\n  });\n};\n\n/*\nexports.onQuit(callback)\nexports.onVisiblityChange(callback)\n*/\n\n/**\n * Pass a callback function to be called when Fullscreen is enabled or disabled.\n * Inspect `event.type` to distinguis between entering and exiting fullscreen.\n *\n * @param {Function} callback to be called\n * @param {Object} scope within which the callback should be called. It's `this` during invocation. (optional)\n */\nexports.onFullscreen = function(callback, scope) {\n   if (typeof(callback) !== 'function') {\n      throw new Error('Callback must be a function');\n   }\n   _CALLBACKS.push({\n      callback: callback,\n      scope: scope,\n      type: exports.DISPLAY_FULLSCREEN_ENABLED\n   });\n   _CALLBACKS.push({\n      callback: callback,\n      scope: scope,\n      type: exports.DISPLAY_FULLSCREEN_DISABLED\n   });\n};\n\n/**\n * The function passsed to `onEvent` will be called whenever\n * any event (mouse, keyboard, etc) was triggered.\n *\n * @param {Function} callback to be called\n * @param {Object} scope within which the callback should be called. It's `this` during invocation. (optional)\n */\nexports.onEvent = function(callback, scope) {\n   if (typeof(callback) !== 'function') {\n      throw new Error('Callback must be a function');\n   }\n  _CALLBACKS.push({\n    callback: callback,\n    scope: scope,\n    type: 'all'\n  });\n};\n\n\n/**\n * @param {Function} callback to be called\n * @param {Object} scope within which the callback should be called. It's `this` during invocation. (optional)\n */\nexports.onDisplayResize = function(callback, scope) {\n   if (typeof(callback) !== 'function') {\n      throw new Error('Callback must be a function');\n   };\n\n  _CALLBACKS.push({\n    callback: callback,\n    scope: scope,\n    type: exports.DISPLAY_RESIZE\n  });\n}\n\n/**\n * @param {Function} callback to be called\n * @param {Object} scope within which the callback should be called. It's `this` during invocation. (optional)\n */\nexports.onMouseMotion = function(callback, scope) {\n   if (typeof(callback) !== 'function') {\n      throw new Error('Callback must be a function');\n   }\n  _CALLBACKS.push({\n    callback: callback,\n    scope: scope,\n    type: exports.MOUSE_MOTION\n  });\n};\n\n/**\n * @param {Function} callback to be called\n * @param {Object} scope within which the callback should be called. It's `this` during invocation. (optional)\n */\nexports.onMouseUp = function(callback, scope) {\n   if (typeof(callback) !== 'function') {\n      throw new Error('Callback must be a function');\n   }\n  _CALLBACKS.push({\n    callback: callback,\n    scope: scope,\n    type: exports.MOUSE_UP\n  });\n};\n\n/**\n * @param {Function} callback to be called\n * @param {Object} scope within which the callback should be called. It's `this` during invocation. (optional)\n */\nexports.onMouseDown = function(callback, scope) {\n   if (typeof(callback) !== 'function') {\n      throw new Error('Callback must be a function');\n   }\n  _CALLBACKS.push({\n    callback: callback,\n    scope: scope,\n    type: exports.MOUSE_DOWN\n  });\n};\n\n/**\n * @param {Function} callback to be called\n * @param {Object} scope within which the callback should be called. It's `this` during invocation. (optional)\n */\nexports.onTouchMotion = function(callback, scope) {\n   if (typeof(callback) !== 'function') {\n      throw new Error('Callback must be a function');\n   }\n  _CALLBACKS.push({\n    callback: callback,\n    scope: scope,\n    type: exports.TOUCH_MOTION\n  });\n};\n\n/**\n * @param {Function} callback to be called\n * @param {Object} scope within which the callback should be called. It's `this` during invocation. (optional)\n */\nexports.onTouchUp = function(callback, scope) {\n   if (typeof(callback) !== 'function') {\n      throw new Error('Callback must be a function');\n   }\n  _CALLBACKS.push({\n    callback: callback,\n    scope: scope,\n    type: exports.TOUCH_UP\n  });\n};\n\n/**\n * @param {Function} callback to be called\n * @param {Object} scope within which the callback should be called. It's `this` during invocation. (optional)\n */\nexports.onTouchDown = function(callback, scope) {\n   if (typeof(callback) !== 'function') {\n      throw new Error('Callback must be a function');\n   }\n  _CALLBACKS.push({\n    callback: callback,\n    scope: scope,\n    type: exports.TOUCH_DOWN\n  });\n};\n\n/**\n * @param {Function} callback to be called\n * @param {Object} scope within which the callback should be called. It's `this` during invocation. (optional)\n */\nexports.onKeyDown = function(callback, scope) {\n   if (typeof(callback) !== 'function') {\n      throw new Error('Callback must be a function');\n   }\n  _CALLBACKS.push({\n    callback: callback,\n    scope: scope,\n    type: exports.KEY_DOWN\n  });\n};\n\n/**\n * @param {Function} callback to be called\n * @param {Object} scope within which the callback should be called. It's `this` during invocation. (optional)\n */\nexports.onKeyUp = function(callback, scope) {\n   if (typeof(callback) !== 'function') {\n      throw new Error('Callback must be a function');\n   }\n  _CALLBACKS.push({\n    callback: callback,\n    scope: scope,\n    type: exports.KEY_UP\n  });\n};\n\n// key constants\nexports.K_UP = 38;\nexports.K_DOWN = 40;\nexports.K_RIGHT = 39;\nexports.K_LEFT = 37;\n\nexports.K_SPACE = 32;\nexports.K_BACKSPACE = 8;\nexports.K_TAB = 9;\nexports.K_ENTER = 13;\nexports.K_SHIFT = 16;\nexports.K_CTRL = 17;\nexports.K_ALT = 18;\nexports.K_ESC = 27;\n\nexports.K_0 = 48;\nexports.K_1 = 49;\nexports.K_2 = 50;\nexports.K_3 = 51;\nexports.K_4 = 52;\nexports.K_5 = 53;\nexports.K_6 = 54;\nexports.K_7 = 55;\nexports.K_8 = 56;\nexports.K_9 = 57;\nexports.K_a = 65;\nexports.K_b = 66;\nexports.K_c = 67;\nexports.K_d = 68;\nexports.K_e = 69;\nexports.K_f = 70;\nexports.K_g = 71;\nexports.K_h = 72;\nexports.K_i = 73;\nexports.K_j = 74;\nexports.K_k = 75;\nexports.K_l = 76;\nexports.K_m = 77;\nexports.K_n = 78;\nexports.K_o = 79;\nexports.K_p = 80;\nexports.K_q = 81;\nexports.K_r = 82;\nexports.K_s = 83;\nexports.K_t = 84;\nexports.K_u = 85;\nexports.K_v = 86;\nexports.K_w = 87;\nexports.K_x = 88;\nexports.K_y = 89;\nexports.K_z = 90;\n\nexports.K_KP1 = 97;\nexports.K_KP2 = 98;\nexports.K_KP3 = 99;\nexports.K_KP4 = 100;\nexports.K_KP5 = 101;\nexports.K_KP6 = 102;\nexports.K_KP7 = 103;\nexports.K_KP8 = 104;\nexports.K_KP9 = 105;\n\n// event type constants\nexports.NOEVENT = 0;\nexports.NUMEVENTS = 32000;\n\nexports.DISPLAY_FULLSCREEN_ENABLED = 300;\nexports.DISPLAY_FULLSCREEN_DISABLED = 301;\nexports.DISPLAY_RESIZE = 302;\n\nexports.QUIT = 0;\nexports.KEY_DOWN = 1;\nexports.KEY_UP = 2;\nexports.MOUSE_MOTION = 3;\nexports.MOUSE_UP = 4;\nexports.MOUSE_DOWN = 5;\nexports.MOUSE_WHEEL = 6;\nexports.TOUCH_UP = 7;\nexports.TOUCH_DOWN = 8;\nexports.TOUCH_MOTION = 9;\nexports.USEREVENT = 2000;\n\n\n\n/**\n * Properties of the `event` object argument passed to the callbacks.\n * @class\n */\n\nexports.Event = function() {\n    /**\n     * The type of the event. e.g., gamejs.event.QUIT, KEYDOWN, MOUSEUP.\n     */\n    this.type = null;\n    /**\n     * key the keyCode of the key. compare with gamejs.event.K_a, gamejs.event.K_b,...\n     */\n    this.key = null;\n    /**\n     * relative movement for a mousemove event\n     */\n    this.rel = null;\n    /**\n     * the number of the mousebutton pressed\n     */\n    this.button = null;\n    /**\n     * pos the position of the event for mouse events\n     */\n    this.pos = null;\n};\n\n/**\n * @ignore\n */\nexports.init = function() {\n\n   var lastPos = [];\n\n   // anonymous functions as event handlers = memory leak, see MDC:elementAddEventListener\n\n   function onMouseDown (ev) {\n      var canvasOffset = display._getCanvasOffset();\n      _triggerCallbacks({\n         'type': exports.MOUSE_DOWN,\n         'pos': [ev.clientX - canvasOffset[0], ev.clientY - canvasOffset[1]],\n         'button': ev.button,\n         'shiftKey': ev.shiftKey,\n         'ctrlKey': ev.ctrlKey,\n         'metaKey': ev.metaKey\n      });\n   }\n\n   function onMouseUp (ev) {\n      var canvasOffset = display._getCanvasOffset();\n      _triggerCallbacks({\n         'type':exports.MOUSE_UP,\n         'pos': [ev.clientX - canvasOffset[0], ev.clientY - canvasOffset[1]],\n         'button': ev.button,\n         'shiftKey': ev.shiftKey,\n         'ctrlKey': ev.ctrlKey,\n         'metaKey': ev.metaKey\n      });\n   }\n\n   function onKeyDown (ev) {\n      var key = ev.keyCode || ev.which;\n      _triggerCallbacks({\n         'type': exports.KEY_DOWN,\n         'key': key,\n         'shiftKey': ev.shiftKey,\n         'ctrlKey': ev.ctrlKey,\n         'metaKey': ev.metaKey\n      });\n\n      // if the display has focus, we surpress default action\n      // for most keys\n      if (display._hasFocus() && (!ev.ctrlKey && !ev.metaKey &&\n         ((key >= exports.K_LEFT && key <= exports.K_DOWN) ||\n         (key >= exports.K_0    && key <= exports.K_z) ||\n         (key >= exports.K_KP1  && key <= exports.K_KP9) ||\n         key === exports.K_SPACE ||\n         key === exports.K_TAB ||\n         key === exports.K_ENTER)) ||\n         key === exports.K_ALT ||\n         key === exports.K_BACKSPACE) {\n        ev.preventDefault();\n      }\n   }\n\n   function onKeyUp (ev) {\n      _triggerCallbacks({\n         'type': exports.KEY_UP,\n         'key': ev.keyCode,\n         'shiftKey': ev.shiftKey,\n         'ctrlKey': ev.ctrlKey,\n         'metaKey': ev.metaKey\n      });\n   }\n\n   function onMouseMove (ev) {\n      var canvasOffset = display._getCanvasOffset();\n      var currentPos = [ev.clientX - canvasOffset[0], ev.clientY - canvasOffset[1]];\n      var relativePos = [];\n      if (lastPos.length) {\n         relativePos = [\n            lastPos[0] - currentPos[0],\n            lastPos[1] - currentPos[1]\n         ];\n      }\n      _triggerCallbacks({\n         'type': exports.MOUSE_MOTION,\n         'pos': currentPos,\n         'rel': relativePos,\n         'buttons': null, // FIXME, fixable?\n         'timestamp': ev.timeStamp,\n         'movement': [ev.movementX       ||\n                      ev.mozMovementX    ||\n                      ev.webkitMovementX || 0,\n                      ev.movementY       ||\n                      ev.mozMovementY    ||\n                      ev.webkitMovementY || 0\n                      ]\n      });\n      lastPos = currentPos;\n      return;\n   }\n\n   function onMouseScroll(ev) {\n      var canvasOffset = display._getCanvasOffset();\n      var currentPos = [ev.clientX - canvasOffset[0], ev.clientY - canvasOffset[1]];\n      _triggerCallbacks({\n         type: exports.MOUSE_WHEEL,\n         pos: currentPos,\n         delta: ev.detail || (- ev.wheelDeltaY / 40)\n      });\n      return;\n   }\n\n   function onBeforeUnload (ev) {\n      _triggerCallbacks({\n         'type': exports.QUIT\n      });\n      return;\n   };\n\n   // convert a w3c touch event into gamejs event\n   function w3cTouchConvert(touchList) {\n      var canvasOffset = display._getCanvasOffset();\n      var tList = [];\n      for (var i = 0; i < touchList.length; i++) {\n         var touchEvent = touchList.item(i);\n         tList.push({\n            identifier: touchEvent.identifier,\n            pos: [touchEvent.clientX - canvasOffset[0], touchEvent.clientY - canvasOffset[1]]\n         });\n      }\n      return tList;\n   }\n\n   function onTouchDown(ev) {\n      var canvasOffset = display._getCanvasOffset();\n      var changedTouches = w3cTouchConvert(ev.changedTouches);\n      _triggerCallbacks({\n         'type': exports.TOUCH_DOWN,\n         'touches': changedTouches\n      });\n   };\n\n   function onTouchUp(ev) {\n      var changedTouches = w3cTouchConvert(ev.changedTouches);\n      _triggerCallbacks({\n         'type': exports.TOUCH_UP,\n         'touches': changedTouches,\n      });\n   }\n   function onTouchMotion(ev) {\n      var changedTouches = w3cTouchConvert(ev.changedTouches);\n      _triggerCallbacks({\n         'type': exports.TOUCH_MOTION,\n         'touches': changedTouches\n      });\n      ev.preventDefault();\n   }\n\n   // IE does not support addEventListener on document itself\n   // FX events don't reach body if mouse outside window or on menubar\n   var canvas = display._getCanvas();\n   document.addEventListener('mousedown', onMouseDown, false);\n   document.addEventListener('mouseup', onMouseUp, false);\n   document.addEventListener('keydown', onKeyDown, false);\n   document.addEventListener('keyup', onKeyUp, false);\n   document.addEventListener('mousemove', onMouseMove, false);\n   canvas.addEventListener('mousewheel', onMouseScroll, false);\n   // MOZFIX\n   // https://developer.mozilla.org/en/Code_snippets/Miscellaneous#Detecting_mouse_wheel_events\n   canvas.addEventListener('DOMMouseScroll', onMouseScroll, false);\n   canvas.addEventListener('beforeunload', onBeforeUnload, false);\n   // touchs\n   canvas.addEventListener(\"touchstart\", onTouchDown, false);\n   canvas.addEventListener(\"touchend\", onTouchUp, false);\n   canvas.addEventListener(\"touchcancel\", onTouchUp, false);\n   canvas.addEventListener(\"touchleave\", onTouchUp, false);\n   canvas.addEventListener(\"touchmove\", onTouchMotion, false);\n\n};\n","var Surface = require('./graphics').Surface;\n\n/**\n * @fileoverview Methods to create, access and manipulate the display Surface.\n *\n * You can just grab the canvas element whether it exists in the DOM or not (GameJs\n * will create it if necessary):\n *\n *     var display = gamejs.display.getSurface();\n *\n * If you need to resize the canvas - although it is recommended to style it with CSS - you can\n * call the `setMode()` function, which conviniently returns the new display surface:\n *\n *     newDisplay = gamejs.display.setMode([800, 600]);\n *\n * ### Browser window gets resized\n *\n * When the canvas size is configured with CSS, the display surface might change when\n * the browser window is resized. GameJs will internally deal with this and recreate\n * the the display surface with the new size.\n *\n * You will typically not have to worry about this but if you want to get informed\n * about a display resize, you can register a callback with `gamejs.event.onDisplayResize`.\n *\n *\n * ### Flags\n *\n * For advanced uses you can set a few modes which additionally change how the display\n * behaves with regards to pixel smoothing and whether you want a fullscreen canvas with\n * or withouth the mouse pointer locked inside the window (for endless mouse movement in\n * all directions).\n *\n *\n * `gamejs.display.setMode()` understands three flags:\n *\n *   * gamejs.display.FULLSCREEN\n *   * gamejs.display.DISABLE_SMOOTHING\n *   * gamejs.display.POINTERLOCK (implies FULLSCREEN)\n *\n * For example:\n *      // disable smoothing\n *      gamejs.display.setMode([800, 600], gamejs.display.DISABLE_SMOOTHING);\n *      // disable smoothing and fullscreen\n *      gamejs.display.setMode(\n               [800, 600],\n               gamejs.display.DISABLE_SMOOTHING | gamejs.display.FULLSCREEN\n         );\n *\n * ### Fullscreen mode\n *\n * When `setMode()` is called with the fullscreen flag then the fullscreen mode can be enabled by the\n * player by clicking on the DOM element with id \"gjs-fullscreen-toggle\". Browser security requires\n * that a user enables fullscreen with a \"gesture\" (e.g., clicking a button) and we can not enable fullscreen\n * in code.\n *\n * Fullscreen mode can be exited by many keys, e.g., anything window manager related (ALT-TAB) or ESC. A lot\n * of keys will trigger a browser information popup explaining how fullscreen mode can be exited.\n *\n * The following keys are \"whitelisted\" in fullscreen mode and will not trigger such a browser popup:\n *\n *  * left arrow, right arrow, up arrow, down arrow\n *  * space\n *  * shift, control, alt\n *  * page up, page down\n *  * home, end, tab, meta\n *\n *\n * ### Relevant DOM node ids accessed by this module\n *\n * You can provide your own tags with those ids\n *\n *   * gjs-canvas - the display surface\n *   * gjs-loader - loading bar\n *   * gjs-fullscreen-toggle a clickable element to enable fullscreen\n *   * gjs-canvas-wrapper this wrapper is added when in fullscreen mode\n *\n */\n\nvar CANVAS_ID = \"gjs-canvas\";\nvar LOADER_ID = \"gjs-loader\";\nvar SURFACE = null;\n\n/**\n * Pass this flag to `gamejs.display.setMode(resolution, flags)` to disable\n * pixel smoothing; this is, for example, useful for retro-style, low resolution graphics\n * where you don't want the browser to smooth them when scaling & drawing.\n */\nvar DISABLE_SMOOTHING = exports.DISABLE_SMOOTHING = 2;\nvar FULLSCREEN = exports.FULLSCREEN = 4;\nvar POINTERLOCK = exports.POINTERLOCK = 8;\n\nvar _flags = 0;\n\n/**\n * @returns {document.Element} the canvas dom element\n * @ignore\n */\nvar getCanvas = exports._getCanvas = function() {\n   var displayCanvas = document.getElementById(CANVAS_ID);\n   if (!displayCanvas) {\n      displayCanvas = document.createElement(\"canvas\");\n      displayCanvas.setAttribute(\"id\", CANVAS_ID);\n      document.body.appendChild(displayCanvas);\n   }\n   return displayCanvas;\n};\n\n\nvar getFullScreenToggle = function() {\n   var fullScreenButton = document.getElementById('gjs-fullscreen-toggle');\n   if (!fullScreenButton) {\n      // before canvas\n      fullScreenButton = document.createElement('button');\n      fullScreenButton.innerHTML = 'Fullscreen';\n      fullScreenButton.id = 'gjs-fullscreen-toggle';\n      var canvas = getCanvas();\n      canvas.parentNode.insertBefore(fullScreenButton, canvas);\n      canvas.parentNode.insertBefore(document.createElement('br'), canvas);\n\n   }\n   return fullScreenButton;\n};\n\nvar fullScreenChange = function(event) {\n   var gjsEvent ={\n      type: isFullScreen() ? require('./event').DISPLAY_FULLSCREEN_ENABLED :\n                        require('./event').DISPLAY_FULLSCREEN_DISABLED\n\n   };\n   if (isFullScreen()) {\n      if (_flags & POINTERLOCK) {\n         enablePointerLock();\n      }\n   }\n   require('./event')._triggerCallbacks(gjsEvent);\n};\n\nexports.hasPointerLock = function() {\n   return !!(document.pointerLockElement ||\n      document.webkitFullscreenElement ||\n      document.mozFullscreenElement ||\n      document.mozFullScreenElement);\n};\n\nfunction onResize(event) {\n   var canvas = getCanvas();\n   SURFACE._canvas.width = canvas.clientWidth;\n   SURFACE._canvas.height = canvas.clientHeight;\n   require('./event')._triggerCallbacks({\n      type: require('./event').DISPLAY_RESIZE\n   });\n}\n\n/**\n * Create the master Canvas plane.\n * @ignore\n */\nexports.init = function() {\n   // create canvas element if not yet present\n   var canvas = getCanvas();\n   if (!canvas.getAttribute('tabindex')) {\n      // to be focusable, tabindex must be set\n      canvas.setAttribute(\"tabindex\", 1);\n      canvas.focus();\n   }\n   // remove loader if any;\n   var $loader = document.getElementById(LOADER_ID);\n   if ($loader) {\n      $loader.style.display = \"none\";\n   }\n   var $displaySurface = document.getElementById(CANVAS_ID);\n   if ($displaySurface) {\n      $displaySurface.style.display = 'block';\n   }\n   // hook into resize\n   window.addEventListener(\"resize\", onResize, false);\n   return;\n};\n\nvar isFullScreen = exports.isFullscreen = function() {\n   return (document.fullScreenElement || document.mozFullScreen || document.webkitIsFullScreen || document.webkitDisplayingFullscreen);\n};\n\n/**\n * Switches the display window normal browser mode and fullscreen.\n * @ignore\n * @returns {Boolean} true if operation was successfull, false otherwise\n */\nvar enableFullScreen = function(event) {\n   var wrapper = getCanvas();\n   wrapper.requestFullScreen = wrapper.requestFullScreen || wrapper.mozRequestFullScreen || wrapper.webkitRequestFullScreen;\n   if (!wrapper.requestFullScreen) {\n      return false;\n   }\n   // @xbrowser chrome allows keboard input onl if ask for it (why oh why?)\n   if (Element.ALLOW_KEYBOARD_INPUT) {\n      wrapper.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT);\n   } else {\n      wrapper.requestFullScreen();\n   }\n   return true;\n};\n\nvar enablePointerLock = function() {\n   var wrapper = getCanvas();\n   wrapper.requestPointerLock = wrapper.requestPointerLock || wrapper.mozRequestPointerLock || wrapper.webkitRequestPointerLock;\n   if (wrapper.requestPointerLock) {\n      wrapper.requestPointerLock();\n   }\n};\n\n/** @ignore **/\nexports._hasFocus = function() {\n   return document.activeElement == getCanvas();\n};\n\n/**\n * Set the width and height of the Display. Conviniently this will\n * return the actual display Surface - the same as calling [gamejs.display.getSurface()](#getSurface)\n * later on.\n * @param {Array} dimensions [width, height] of the display surface\n * @param {Number} flags gamejs.display.DISABLE_SMOOTHING | gamejs.display.FULLSCREEN | gamejs.display.POINTERLOCK\n */\nexports.setMode = function(dimensions, flags) {\n   SURFACE = null;\n   var canvas = getCanvas();\n   canvas.width = canvas.clientWidth = dimensions[0];\n   canvas.height = canvas.clientHeight = dimensions[1];\n\n   _flags = _flags || flags;\n   // @ xbrowser firefox allows pointerlock only if fullscreen\n   if (_flags & POINTERLOCK) {\n      _flags = _flags | FULLSCREEN;\n   }\n   if (_flags & FULLSCREEN) {\n      // attach fullscreen toggle checkbox\n      var fullScreenToggle = getFullScreenToggle();\n      fullScreenToggle.removeEventListener('click', enableFullScreen, false);\n      fullScreenToggle.addEventListener('click', enableFullScreen, false);\n      // @@ xbrowser\n      document.removeEventListener('fullScreenchange',fullScreenChange, false);\n      document.removeEventListener('webkitfullscreenchange',fullScreenChange, false);\n      document.removeEventListener('mozfullscreenchange',fullScreenChange, false);\n      document.addEventListener('fullscreenchange', fullScreenChange, false);\n      document.addEventListener('webkitfullscreenchange', fullScreenChange, false);\n      document.addEventListener('mozfullscreenchange', fullScreenChange, false);\n   }\n   return getSurface(dimensions);\n};\n\n/**\n * Set the Caption of the Display (document.title)\n * @param {String} title the title of the app\n * @param {gamejs.Image} icon FIXME implement favicon support\n */\nexports.setCaption = function(title, icon) {\n   document.title = title;\n};\n\n/** @ignore **/\nexports._isSmoothingEnabled = function() {\n   return !(_flags & DISABLE_SMOOTHING);\n};\n\n/**\n * The Display (the canvas element) is most likely not in the top left corner\n * of the browser due to CSS styling. To calculate the mouseposition within the\n * canvas we need this offset.\n * @see gamejs/event\n * @ignore\n *\n * @returns {Array} [x, y] offset of the canvas\n */\n\nexports._getCanvasOffset = function() {\n   var boundRect = getCanvas().getBoundingClientRect();\n   return [boundRect.left, boundRect.top];\n};\n\n/**\n * Drawing on the Surface returned by `getSurface()` will draw on the screen.\n * @returns {gamejs.Surface} the display Surface\n */\nvar getSurface = exports.getSurface = function(dimensions) {\n   if (SURFACE === null) {\n      var canvas = getCanvas();\n      if (dimensions === undefined) {\n         dimensions = [canvas.clientWidth, canvas.clientHeight];\n      }\n      SURFACE = new Surface(dimensions);\n      SURFACE._canvas = canvas;\n      SURFACE._canvas.width = dimensions[0];\n      SURFACE._canvas.height = dimensions[1];\n      SURFACE._context = canvas.getContext('2d');\n      if (!(_flags & DISABLE_SMOOTHING)) {\n         SURFACE._smooth();\n      } else {\n         SURFACE._noSmooth();\n      }\n   }\n   return SURFACE;\n};\n","/**\n * @fileoverview\n * This module holds the important `Surface` class which is the general container for image data.\n *\n *     var surface = new gamejs.graphics.Surface([width, height]);\n *\n * The functions\n * to draw geometric lines like circles, lines, rectangles, etc. are also all in this module:\n *\n *     gamejs.graphics.line(surface, '#ff0000', centerPoint, radius);\n *\n * Each Surface instance has methods to create *a new* rotated, flipped, scaled, etc. instance of itself:\n *\n *     // the original `surface` remains untouched by the\n *     // filp operation. A new Surface instance\n *     // is returned by `flip()`.\n *     var horizontalFlippedSurface = surface.flip(true);\n *\n * If you want to put images (png, jpg) on the screen, also see the `gamejs.image` module and `gamejs.preload()`.\n *\n * There are several ways to specify colors. Whenever the docs says \"valid #RGB string\"\n * you can pass in any of the following formats: `\"#ff00ff\"`, `\"rgb(255, 0, 255)\"` or `\"rgba(255, 0, 255, 1)\"`.\n *\n * @see gamejs/image\n */\nvar gamejs = require('../gamejs');\nvar Rect = gamejs.Rect;\nvar objects = require('./utils/objects');\n\n/**\n * transform functions\n */\nvar matrix = require('./math/matrix');\nvar vectors = require('./math/vectors');\n\n/**\n * A Surface represents a bitmap image with a fixed width and height. The\n * most important feature of a Surface is that they can be `blitted`\n * onto each other.\n *\n * @example\n * new gamejs.graphics.Surface([width, height]);\n * new gamejs.graphics.Surface(width, height);\n * new gamejs.graphics.Surface(rect);\n * @constructor\n *\n * @param {Array} dimensions Array holding width and height\n */\nvar Surface = exports.Surface = function() {\n   var args = gamejs.normalizeRectArguments.apply(this, arguments);\n   var width = args.left;\n   var height = args.top;\n   // unless argument is rect:\n   if (arguments.length == 1 && arguments[0] instanceof Rect) {\n      width = args.width;\n      height = args.height;\n   }\n   // only for rotatation & scale\n   /** @ignore */\n   this._matrix = matrix.identity();\n   /** @ignore */\n    this._canvas = document.createElement(\"canvas\");\n    this._canvas.width = width;\n    this._canvas.height = height;\n    /** @ignore */\n    this._blitAlpha = 1.0;\n\n   /** @ignore */\n   this._context = this._canvas.getContext('2d');\n   // using exports is weird but avoids circular require\n   if (gamejs.display._isSmoothingEnabled()) {\n      this._smooth();\n   } else {\n      this._noSmooth();\n   }\n   return this;\n};\n\n/** @ignore */\nSurface.prototype._noSmooth = function() {\n    // disable image scaling\n    // see https://developer.mozilla.org/en/Canvas_tutorial/Using_images#Controlling_image_scaling_behavior\n    // and https://github.com/jbuck/processing-js/commit/65de16a8340c694cee471a2db7634733370b941c\n    this.context.mozImageSmoothingEnabled = false;\n  this.context.webkitImageSmoothingEnabled = false;\n   return;\n};\n/** @ignore */\nSurface.prototype._smooth = function() {\n  this.context.mozImageSmoothingEnabled = true;\n  this.context.webkitImageSmoothingEnabled = true;\n\n};\n\n/**\n * Blits another Surface on this Surface. The destination where to blit to\n * can be given (or it defaults to the top left corner) as well as the\n * Area from the Surface which should be blitted (e.g., for cutting out parts of\n * a Surface).\n *\n * @example\n * // blit flower in top left corner of display\n * displaySurface.blit(flowerSurface);\n *\n * // position flower at 10/10 of display\n * displaySurface.blit(flowerSurface, [10, 10])\n *\n * // ... `dest` can also be a rect whose topleft position is taken:\n * displaySurface.blit(flowerSurface, new gamejs.Rect([10, 10]);\n *\n * // only blit half of the flower onto the display\n * var flowerRect = flowerSurface.rect;\n * flowerRect = new gamejs.Rect([0,0], [flowerRect.width/2, flowerRect.height/2])\n * displaySurface.blit(flowerSurface, [0,0], flowerRect);\n *\n * @param {gamejs.graphics.Surface} src The Surface which will be blitted onto this one\n * @param {gamejs.Rect|Array} dst the Destination x, y position in this Surface.\n *            If a Rect is given, it's top and left values are taken. If this argument\n *            is not supplied the blit happens at [0,0].\n * @param {gamesjs.Rect|Array} area the Area from the passed Surface which\n *            should be blitted onto this Surface.\n * @param {Number} compositionOperation how the source and target surfaces are composited together; one of: source-atop, source-in, source-out, source-over (default), destination-atop, destination-in, destination-out, destination-over, lighter, copy, xor; for an explanation of these values see: http://dev.w3.org/html5/2dcontext/#dom-context-2d-globalcompositeoperation\n * @returns {gamejs.Rect} Rect actually repainted FIXME actually return something?\n */\nSurface.prototype.blit = function(src, dest, area, compositeOperation) {\n\n   var rDest, rArea;\n\n   if (dest instanceof Rect) {\n      rDest = dest.clone();\n      var srcSize = src.getSize();\n      if (!rDest.width) {\n         rDest.width = srcSize[0];\n      }\n      if (!rDest.height) {\n         rDest.height = srcSize[1];\n      }\n    } else if (dest && dest instanceof Array && dest.length == 2) {\n      rDest = new Rect(dest, src.getSize());\n    } else {\n      rDest = new Rect([0,0], src.getSize());\n    }\n   compositeOperation = compositeOperation || 'source-over';\n\n   // area within src to be drawn\n   if (area instanceof Rect) {\n      rArea = area;\n   } else if (area && area instanceof Array && area.length == 2) {\n      var size = src.getSize();\n      rArea = new Rect(area, [size[0] - area[0], size[1] - area[1]]);\n   } else {\n      rArea = new Rect([0,0], src.getSize());\n   }\n\n   if (isNaN(rDest.left) || isNaN(rDest.top) || isNaN(rDest.width) || isNaN(rDest.height)) {\n      throw new Error('[blit] bad parameters, destination is ' + rDest);\n   }\n\n   this.context.save();\n   this.context.globalCompositeOperation = compositeOperation;\n   this.context.globalAlpha = src._blitAlpha;\n   this.context.drawImage(src.canvas, rArea.left, rArea.top, rArea.width, rArea.height, rDest.left, rDest.top, rDest.width, rDest.height);\n   this.context.restore();\n   return;\n};\n\n/**\n * @returns {Number[]} the width and height of the Surface\n */\nSurface.prototype.getSize = function() {\n   return [this.canvas.width, this.canvas.height];\n};\n\n/**\n * Obsolte, only here for compatibility.\n * @deprecated\n * @ignore\n * @returns {gamejs.Rect} a Rect of the size of this Surface\n */\nSurface.prototype.getRect = function() {\n   return new Rect([0,0], this.getSize());\n};\n\n/**\n * Fills the whole Surface with a color. Usefull for erasing a Surface.\n * @param {String} CSS color string, e.g. '#0d120a' or '#0f0' or 'rgba(255, 0, 0, 0.5)'\n * @param {gamejs.Rect} a Rect of the area to fill (defauts to entire surface if not specified)\n */\nSurface.prototype.fill = function(color, rect) {\n   this.context.save();\n   this.context.fillStyle = color || \"#000000\";\n   if (rect === undefined) {\n       rect = new Rect(0, 0, this.canvas.width, this.canvas.height);\n    }\n\n   this.context.fillRect(rect.left, rect.top, rect.width, rect.height);\n   this.context.restore();\n   return;\n};\n\n/**\n * Clear the surface.\n */\nSurface.prototype.clear = function(rect) {\n   var size = this.getSize();\n   rect = rect || new Rect(0, 0, size[0], size[1]);\n   this.context.clearRect(rect.left, rect.top, rect.width, rect.height);\n   return;\n};\n\nobjects.accessors(Surface.prototype, {\n   /**\n    * @type gamejs.Rect\n    */\n   'rect': {\n      get: function() {\n         return this.getRect();\n      }\n   },\n   /**\n    * @ignore\n    */\n   'context': {\n      get: function() {\n         return this._context;\n      }\n   },\n   'canvas': {\n      get: function() {\n         return this._canvas;\n      }\n   }\n});\n\n/**\n * @returns {gamejs.graphics.Surface} a clone of this surface\n */\nSurface.prototype.clone = function() {\n  var newSurface = new Surface(this.getRect());\n  newSurface.blit(this);\n  return newSurface;\n};\n\n/**\n * @returns {Number} current alpha value\n */\nSurface.prototype.getAlpha = function() {\n   return (1 - this._blitAlpha);\n};\n\n/**\n * Set the alpha value for the whole Surface. When blitting the Surface on\n * a destination, the pixels will be drawn slightly transparent.\n * @param {Number} alpha value in range 0.0 - 1.0\n * @returns {Number} current alpha value\n */\nSurface.prototype.setAlpha = function(alpha) {\n   if (isNaN(alpha) || alpha < 0 || alpha > 1) {\n      return;\n   }\n\n   this._blitAlpha = (1 - alpha);\n   return (1 - this._blitAlpha);\n};\n\n/**\n * The data must be represented in left-to-right order, row by row top to bottom,\n * starting with the top left, with each pixel's red, green, blue, and alpha components\n * being given in that order for each pixel.\n * @see http://dev.w3.org/html5/2dcontext/#canvaspixelarray\n * @returns {ImageData} an object holding the pixel image data {data, width, height}\n */\nSurface.prototype.getImageData = function() {\n   var size = this.getSize();\n   return this.context.getImageData(0, 0, size[0], size[1]);\n};\n\n\n\n// FIXME all draw functions must return a minimal rect containing the drawn shape\n\n/**\n * @param {gamejs.graphics.Surface} surface the Surface to draw on\n * @param {String} color valid #RGB string, e.g., \"#ff0000\"\n * @param {Array} startPos [x, y] position of line start\n * @param {Array} endPos [x, y] position of line end\n * @param {Number} width of the line, defaults to 1\n */\nexports.line = function(surface, color, startPos, endPos, width) {\n   var ctx = surface.context;\n   ctx.save();\n   ctx.beginPath();\n   ctx.strokeStyle = color;\n   ctx.lineWidth = width || 1;\n   ctx.moveTo(startPos[0], startPos[1]);\n   ctx.lineTo(endPos[0], endPos[1]);\n   ctx.stroke();\n   ctx.restore();\n   return;\n};\n\n/**\n * Draw connected lines. Use this instead of indiviudal line() calls for\n * better performance\n *\n * @param {gamejs.graphics.Surface} surface the Surface to draw on\n * @param {String} color a valid #RGB string, \"#ff0000\"\n * @param {Boolean} closed if true the last and first point are connected\n * @param {Array} pointlist holding array [x,y] arrays of points\n * @param {Number} width width of the lines, defaults to 1\n */\nexports.lines = function(surface, color, closed, pointlist, width) {\n   closed = closed || false;\n   var ctx = surface.context;\n   ctx.save();\n   ctx.beginPath();\n   ctx.strokeStyle = ctx.fillStyle = color;\n   ctx.lineWidth = width || 1;\n   pointlist.forEach(function(point, idx) {\n      if (idx === 0) {\n         ctx.moveTo(point[0], point[1]);\n      } else {\n         ctx.lineTo(point[0], point[1]);\n      }\n   });\n   if (closed) {\n      ctx.lineTo(pointlist[0][0], pointlist[0][1]);\n   }\n   ctx.stroke();\n   ctx.restore();\n   return;\n};\n\n/**\n * Draw a circle on Surface\n *\n * @param {gamejs.graphics.Surface} surface the Surface to draw on\n * @param {String} color a valid #RGB String, #ff00cc\n * @param {Array} pos [x, y] position of the circle center\n * @param {Number} radius of the circle\n * @param {Number} width width of the circle, if not given or 0 the circle is filled\n */\nexports.circle = function(surface, color, pos, radius, width) {\n   if (isNaN(radius)) {\n      throw new Error('[circle] radius required argument');\n   }\n   if (!pos || !(pos instanceof Array)) {\n      throw new Error('[circle] pos must be given & array' + pos);\n   }\n\n   var ctx = surface.context;\n   ctx.save();\n   ctx.beginPath();\n   ctx.strokeStyle = ctx.fillStyle = color;\n   ctx.lineWidth = width || 1;\n   ctx.arc(pos[0], pos[1], radius, 0, 2*Math.PI, true);\n   if (width === undefined || width === 0) {\n      ctx.fill();\n   } else {\n      ctx.stroke();\n   }\n   ctx.restore();\n   return;\n};\n\n/**\n * @param {gamejs.graphics.Surface} surface the Surface to draw on\n * @param {String} color a valid #RGB String, #ff00cc\n * @param {gamejs.Rect} rect the position and dimension attributes of this Rect will be used\n * @param {Number} width the width of line drawing the Rect, if 0 or not given the Rect is filled.\n */\nexports.rect = function(surface, color, rect, width) {\n   var ctx =surface.context;\n   ctx.save();\n   ctx.beginPath();\n   ctx.strokeStyle = ctx.fillStyle = color;\n   if (isNaN(width) || width === 0) {\n      ctx.fillRect(rect.left, rect.top, rect.width, rect.height);\n   } else {\n      ctx.lineWidth = width || 1;\n      ctx.strokeRect(rect.left, rect.top, rect.width, rect.height);\n   }\n   ctx.restore();\n};\n\n/**\n * @param {gamejs.graphics.Surface} surface the Surface to draw on\n * @param {String} color a valid #RGB String, #ff00cc\n * @param {Array} pos [x, y] position of the circle center\n * @param {Number} startAngle, both angles in radians\n * @param {Number} stopAngle\n * @param {Number} radius\n * @param {Number} width the width of line, if 0 or not given the arc is filled.\n */\nexports.arc= function(surface, color, pos, startAngle, stopAngle, radius, width) {\n   var ctx = surface.context;\n   ctx.save();\n   ctx.beginPath();\n   ctx.strokeStyle = ctx.fillStyle = color;\n   ctx.arc(pos[0], pos[1],\n            radius,\n            startAngle, stopAngle,\n            false\n         );\n   if (isNaN(width) || width === 0) {\n      ctx.fill();\n   } else {\n      ctx.lineWidth = width || 1;\n      ctx.stroke();\n   }\n   ctx.restore();\n};\n\n/**\n * Draw a polygon on the surface. The pointlist argument are the vertices\n * for the polygon.\n *\n * @param {gamejs.graphics.Surface} surface the Surface to draw on\n * @param {String} color a valid #RGB String, #ff00cc\n * @param {Array} pointlist array of vertices [x, y] of the polygon\n * @param {Number} width the width of line, if 0 or not given the polygon is filled.\n */\nexports.polygon = function(surface, color, pointlist, width) {\n   var ctx = surface.context;\n   ctx.save();\n   ctx.fillStyle = ctx.strokeStyle = color;\n   ctx.beginPath();\n   pointlist.forEach(function(point, idx) {\n      if (idx === 0) {\n         ctx.moveTo(point[0], point[1]);\n      } else {\n         ctx.lineTo(point[0], point[1]);\n      }\n   });\n   ctx.closePath();\n   if (isNaN(width) || width === 0) {\n      ctx.fill();\n   } else {\n      ctx.lineWidth = width || 1;\n      ctx.stroke();\n   }\n   ctx.restore();\n};\n\n/**\n * Draw a quadratic curve with one control point on the surface.\n * The control point position defines the shape of the quadratic curve.\n *\n * @param {gamejs.graphics.Surface} surface the Surface to draw on\n * @param {String} color valid #RGB string, e.g., \"#ff0000\"\n * @param {Array} startPos [x, y] the start position for the quadratic curve\n * @param {Array} endPos [x, y] the end position for the quadratic curve\n * @param {Array} controlPos [x, y] position of the control point\n * @param {Number} width of the quadratic curve, defaults to 1\n */\nexports.quadraticCurve = function(surface, color, startPos, endPos, controlPos, width) {\n   if (!startPos || !(startPos instanceof Array)) {\n      throw new Error('[quadratic_curve] startPos must be defined!');\n   }\n   if (!endPos || !(endPos instanceof Array)) {\n      throw new Error('[quadratic_curve] endPos must be defined!');\n   }\n   if (!controlPos || !(controlPos instanceof Array)) {\n      throw new Error('[quadratic_curve] controlPos must be defined!');\n   }\n\n   var ctx = surface.context;\n   ctx.save();\n   ctx.fillStyle = ctx.strokeStyle = color;\n   ctx.lineWidth = width || 1;\n\n   ctx.beginPath();\n   ctx.moveTo(startPos[0], startPos[1]);\n   ctx.quadraticCurveTo(controlPos[0], controlPos[1], endPos[0], endPos[1]);\n   ctx.stroke();\n\n   ctx.restore();\n};\n\n/**\n * Draw a bezier curve with two control points on the surface.\n * The control point positions define the shape of the bezier curve.\n *\n * @param {gamejs.graphics.Surface} surface the Surface to draw on\n * @param {String} color valid #RGB string, e.g., \"#ff0000\"\n * @param {Array} startPos [x, y] the start position for the bezier curve\n * @param {Array} endPos [x, y] the end position for the bezier curve\n * @param {Array} ct1Pos [x, y] position of the first control point\n * @param {Array} ct2Pos [x, y] position of the second control point\n * @param {Number} width of the bezier curve, defaults to 1\n */\nexports.bezierCurve = function(surface, color, startPos, endPos, ct1Pos, ct2Pos, width) {\n   if (!startPos || !(startPos instanceof Array)) {\n      throw new Error('[bezier_curve] startPos must be defined!');\n   }\n   if (!endPos || !(endPos instanceof Array)) {\n      throw new Error('[bezier_curve] endPos must be defined!');\n   }\n   if (!ct1Pos || !(ct1Pos instanceof Array)) {\n      throw new Error('[bezier_curve] ct1Pos must be defined!');\n   }\n   if (!ct2Pos || !(ct2Pos instanceof Array)) {\n      throw new Error('[bezier_curve] ct2Pos must be defined!');\n   }\n   var ctx = surface.context;\n   ctx.save();\n   ctx.fillStyle = ctx.strokeStyle = color;\n   ctx.lineWidth = width || 1;\n\n   ctx.beginPath();\n   ctx.moveTo(startPos[0], startPos[1]);\n   ctx.bezierCurveTo(ct1Pos[0], ct1Pos[1], ct2Pos[0], ct2Pos[1], endPos[0], endPos[1]);\n   ctx.stroke();\n\n   ctx.restore();\n};\n\n/**\n * Returns a new surface which holds this surface rotate by angle degrees.\n * Unless rotating by 90 degree increments, the image will be padded larger to hold the new size.\n * @param {angel} angle Clockwise angle by which to rotate\n * @returns {Surface} new, rotated surface\n */\nSurface.prototype.rotate = function (angle) {\n   var origSize = this.getSize();\n   var radians = (angle * Math.PI / 180);\n   var newSize = origSize;\n   // find new bounding box\n   if (angle % 360 !== 0) {\n      var rect = this.getRect();\n      var points = [\n         [-rect.width/2, rect.height/2],\n         [rect.width/2, rect.height/2],\n         [-rect.width/2, -rect.height/2],\n         [rect.width/2, -rect.height/2]\n      ];\n      var rotPoints = points.map(function(p) {\n         return vectors.rotate(p, radians);\n      });\n      var xs = rotPoints.map(function(p) { return p[0]; });\n      var ys = rotPoints.map(function(p) { return p[1]; });\n      var left = Math.min.apply(Math, xs);\n      var right = Math.max.apply(Math, xs);\n      var bottom = Math.min.apply(Math, ys);\n      var top = Math.max.apply(Math, ys);\n      newSize = [right-left, top-bottom];\n   }\n   var newSurface = new Surface(newSize);\n   var m = matrix.translate(this._matrix, origSize[0]/2, origSize[1]/2);\n   m = matrix.rotate(m, radians);\n   m = matrix.translate(m, -origSize[0]/2, -origSize[1]/2);\n   var offset = [(newSize[0] - origSize[0]) / 2, (newSize[1] - origSize[1]) / 2];\n   newSurface.context.save();\n   newSurface.context.transform(m[0], m[1], m[2], m[3], m[4], m[5]);\n   newSurface.blit(this, offset);\n   newSurface.context.restore();\n   return newSurface;\n};\n\n/**\n * Returns a new surface holding the scaled surface.\n * @param {Array} dimensions new [width, height] of surface after scaling\n * @returns {Surface} new, scaled surface\n */\nSurface.prototype.scale = function(dims) {\n   var width = dims[0];\n   var height = dims[1];\n   if (width <= 0 || height <= 0) {\n      throw new Error('[gamejs.transform.scale] Invalid arguments for height and width', [width, height]);\n   }\n   var oldDims = this.getSize();\n   var ws = width / oldDims[0];\n   var hs = height / oldDims[1];\n   var newSurface = new Surface([width, height]);\n   var originalMatrix = this._matrix.slice(0);\n   var m = matrix.scale(matrix.identity(), [ws, hs]);\n   newSurface.context.save();\n   newSurface.context.transform(m[0], m[1], m[2], m[3], m[4], m[5]);\n   newSurface.blit(this);\n   newSurface.context.restore();\n   return newSurface;\n};\n\n/**\n * Flip a Surface either vertically, horizontally or both. This returns\n * a new Surface (i.e: nondestructive).\n * @param {Boolean} flipHorizontal\n * @param {Boolean} flipVertical\n * @returns {Surface} new, flipped surface\n */\nSurface.prototype.flip = function(flipHorizontal, flipVertical) {\n   var dims = this.getSize();\n   var newSurface = new Surface(dims);\n   var scaleX = 1;\n   var scaleY = 1;\n   var xPos = 0;\n   var yPos = 0;\n   if (flipHorizontal === true) {\n      scaleX = -1;\n      xPos = -dims[0];\n   }\n   if (flipVertical === true) {\n      scaleY = -1;\n      yPos = -dims[1];\n   }\n   newSurface.context.save();\n   newSurface.context.scale(scaleX, scaleY);\n   newSurface.context.drawImage(this.canvas, xPos, yPos);\n   newSurface.context.restore();\n   return newSurface;\n};\n\n\n/**\n * Directly copy values from an array into a Surface.\n *\n * This is faster than blitting the `surface` property on a SurfaceArray\n *\n * The array must be the same dimensions as the Surface and will completely\n * replace all pixel values.\n * @param {gamejs.graphics.Surface} surface\n * @param {gamejs.graphics.Surfacearray.SurfaceArray} surfaceArray\n */\nexports.blitArray = function(surface, surfaceArray) {\n   surface.context.putImageData(surfaceArray.imageData, 0, 0);\n   return;\n};\n\n/**\n * Fast pixel access. The SurfaceArray can be constructed with a surface whose values\n * are then used to initialize the pixel array.\n *\n * The surface passed as argument is not modified by the SurfaceArray.\n *\n * If an array is used to construct SurfaceArray, the array must describe\n * the dimensions of the SurfaceArray [width, height].\n *\n * @example\n *\n *   // create array from display surface\n *   var srfArray = new SurfaceArray(display);\n *   // direct pixel access\n *   srfArray.set(50, 100, [255, 0, 0, 100]);\n *   console.log(srfArray.get(30, 50));\n *   // blit modified array back to display surface\n *   blitArray(display, srfArray);\n *\n * @param {gamejs.graphics.Surface|Array} surfaceOrDimensions\n * @see http://dev.w3.org/html5/2dcontext/#pixel-manipulation\n */\nvar SurfaceArray = exports.SurfaceArray = function(surfaceOrDimensions) {\n   var size = null;\n   var data = null;\n   var imageData = null;\n\n   /**\n    * Set rgba value at position x, y.\n    *\n    * For performance reasons this function has only one signature\n    * being Number, Number, Array[4].\n    *\n    * @param {Number} x x position of pixel\n    * @param {Number} y y position of pixel\n    * @param {Array} rgba [red, green, blue, alpha] values [255, 255, 255, 255] (alpha, the last argument defaults to 255)\n    * @throws Error if x, y out of range\n    */\n   this.set = function(x, y, rgba) {\n      var offset = (x * 4) + (y * size[0] * 4);\n      /** faster without\n      if (offset + 3 >= data.length || x < 0 || y < 0) {\n         throw new Error('x, y out of range', x, y);\n      }\n      **/\n      data[offset] = rgba[0];\n      data[offset+1] = rgba[1];\n      data[offset+2] = rgba[2];\n      data[offset+3] = rgba[3] === undefined ? 255 : rgba[3];\n      return;\n   };\n\n   /**\n    * Get rgba value at position xy,\n    * @param {Number} x\n    * @param {Number} y\n    * @returns {Array} [red, green, blue, alpha]\n    */\n   this.get = function(x, y) {\n      var offset = (x * 4) + (y * size[0] * 4);\n      return [\n         data[offset],\n         data[offset+1],\n         data[offset+2],\n         data[offset+3]\n      ];\n   };\n\n   /**\n    * a new gamejs.graphics.Surface on every access, representing\n    * the current state of the SurfaceArray.\n    * @type {gamejs.graphics.Surface}\n    */\n   // for jsdoc only\n   this.surface = null;\n\n   objects.accessors(this, {\n      surface: {\n         get: function() {\n            var s = new gamejs.graphics.Surface(size);\n            s.context.putImageData(imageData, 0, 0);\n            return s;\n         }\n      },\n      imageData: {\n         get: function() {\n            return imageData;\n         }\n      }\n   });\n\n   this.getSize = function() {\n      return size;\n   };\n\n   /**\n    * constructor\n    */\n   if (surfaceOrDimensions instanceof Array) {\n      size = surfaceOrDimensions;\n      imageData = gamejs.display.getSurface().context.createImageData(size[0], size[1]);\n      data = imageData.data;\n   } else {\n      size = surfaceOrDimensions.getSize();\n      imageData = surfaceOrDimensions.getImageData(0, 0, size[0], size[1]);\n      data = imageData.data;\n   }\n   return this;\n};\n","/**\n * Vector operations.\n\n */\nvar angles = require('./angles');\n\n/**\n * @param {Array} origin point [b0, b1]\n * @param {Array} target point [b0, b1]\n * @returns {Number} distance between two points\n */\nexports.distance = function(a, b) {\n   return len(subtract(a, b));\n};\n\n/**\n * subtracts vectors [a0, a1] - [a0, a1]\n * @param {Array} a\n * @param {Array} b\n * @returns {Array} vector\n */\nvar subtract = exports.subtract = function(a, b) {\n   return [a[0] - b[0], a[1] - b[1]];\n};\n\n/**\n * adds vectors [a0, a1] - [a0, a1]\n * @param {Array} a vector\n * @param {Array} b vector\n * @returns {Array} vector\n */\nvar add = exports.add = function(a, b) {\n   return [a[0] + b[0], a[1] + b[1]];\n};\n\n/**\n * multiply vector with scalar or other vector\n * @param {Array} vector [v0, v1]\n * @param {Number|Array} vector or number\n * @returns {Number|Array} result\n */\nvar multiply = exports.multiply = function(a, s) {\n   if (typeof s === 'number') {\n      return [a[0] * s, a[1] * s];\n   }\n\n   return [a[0] * s[0], a[1] * s[1]];\n};\n\n/**\n * @param {Array} a vector\n * @param {Number} s\n */\nexports.divide = function(a, s) {\n   if (typeof s === 'number') {\n      return [a[0] / s, a[1] / s];\n   }\n   throw new Error('only divide by scalar supported');\n};\n\n/**\n * @param {Array} vector [v0, v1]\n * @returns {Number} length of vector\n */\nvar len = exports.len = function(v) {\n   return Math.sqrt(v[0]*v[0] + v[1]*v[1]);\n};\n\n/**\n *\n * normalize vector to unit vector\n * @param {Array} vector [v0, v1]\n * @returns {Array} unit vector [v0, v1]\n */\nvar unit = exports.unit = function(v) {\n   var l = len(v);\n   if(l) {\n      return [v[0] / l, v[1] / l];\n   }\n   return [0, 0];\n};\n\n/**\n *\n * rotate vector\n * @param {Array} vector [v0, v1]\n * @param {Number} angle to rotate vector by, radians. can be negative\n * @returns {Array} rotated vector [v0, v1]\n */\nexports.rotate=function(v, angle){\n   angle=angles.normaliseRadians(angle);\n   return [v[0]* Math.cos(angle)-v[1]*Math.sin(angle),\n           v[0]* Math.sin(angle)+v[1]*Math.cos(angle)];\n\n};\n\n/**\n *\n * calculate vector dot product\n * @param {Array} vector [v0, v1]\n * @param {Array} vector [v0, v1]\n * @returns {Number} dot product of v1 and v2\n */\nvar dot = exports.dot=function(v1, v2){\n   return (v1[0] * v2[0]) + (v1[1] * v2[1]);\n};\n\n/**\n *\n * calculate angle between vectors\n * @param {Array} vector [v0, v1]\n * @param {Array} vector [v0, v1]\n * @returns {Number} angle between v1 and v2 in radians\n */\nexports.angle=function(v1, v2){\n   var perpDot = v1[0] * v2[1] - v1[1] * v2[0];\n   return Math.atan2(perpDot, dot(v1,v2));\n};\n\n/**\n * @returns {Array} vector with max length as specified.\n */\nexports.truncate = function(v, maxLength) {\n   if (len(v) > maxLength) {\n      return multiply(unit(v), maxLength);\n   }\n   return v;\n};\n\n\n/**\n * @returns the center of multipled 2d points\n * @param {Array} first point\n * @param {Array} second point\n * @param {Array} ...\n */\nexports.centroid = function() {\n   var args = Array.prototype.slice.apply(arguments, [0]);\n   var c = [0,0];\n   args.forEach(function(p) {\n      c[0] += parseInt(p[0], 10);\n      c[1] += parseInt(p[1], 10);\n   });\n   var len = args.length;\n   return [\n      c[0] / len,\n      c[1] / len\n   ];\n};\n","/**\n * @fileoverview Degrees and radians.\n *\n */\n\n/**\n *\n * absolute angle to relative angle, in degrees\n * @param {Number} absolute angle in degrees\n * @returns {Number} relative angle in degrees\n */\nexports.normaliseDegrees=function(degrees){\n    degrees=degrees % 360;\n    if(degrees<0) {\n        degrees+=360;\n    }\n    return degrees;\n};\n\n/**\n *\n * absolute angle to relative angle, in radians\n * @param {Number} absolute angle in radians\n * @returns {Number} relative angle in radians\n */\nexports.normaliseRadians=function(radians){\n    radians=radians % (2*Math.PI);\n    if(radians<0) {\n        radians+=(2*Math.PI);\n    }\n    return radians;\n};\n\n/**\n *\n * convert radians to degrees\n * @param {Number} radians\n * @returns {Number} degrees\n */\nexports.degrees=function(radians) {\n    return radians*(180/Math.PI);\n};\n\n/**\n *\n * convert degrees to radians\n * @param {Number} degrees\n * @returns {Number} radians\n */\nexports.radians=function(degrees) {\n    return degrees*(Math.PI/180);\n};\n","var Surface = require('./graphics').Surface;\nvar objects = require('./utils/objects');\n\n/**\n * @fileoverview Methods for creating Font objects which can render text\n * to a Surface.\n *\n * @example\n * var font = new Font('20px monospace');\n * // render text - this returns a surface with the text written on it.\n * var helloSurface = font.render('Hello World')\n */\n\n/**\n * Create a Font to draw on the screen. The Font allows you to\n * `render()` text. Rendering text returns a Surface which\n * in turn can be put on screen.\n *\n * @constructor\n * @property {Number} fontHeight the line height of this Font\n *\n * @param {String} fontSettings a css font definition, e.g., \"20px monospace\"\n * @param {STring} backgroundColor valid #rgb string, \"#ff00cc\"\n */\nvar Font = exports.Font = function(fontSettings, backgroundColor) {\n    /**\n     * @ignore\n     */\n   this.sampleSurface = new Surface([10,10]);\n   this.sampleSurface.context.font = fontSettings;\n   this.sampleSurface.context.textAlign = 'start';\n   // http://diveintohtml5.org/canvas.html#text\n   this.sampleSurface.context.textBaseline = 'bottom';\n   this.backgroundColor = backgroundColor || false;\n   return this;\n};\n\n/**\n * Returns a Surface with the given text on it.\n * @param {String} text the text to render\n * @param {String} color a valid #RGB String, \"#ffcc00\"\n * @returns {gamejs.Surface} Surface with the rendered text on it.\n */\nFont.prototype.render = function(text, color) {\n   var dims = this.size(text);\n   var surface = new Surface(dims);\n   var ctx = surface.context;\n   ctx.save();\n   if ( this.backgroundColor ) {\n       ctx.fillStyle = this.backgroundColor;\n       ctx.fillRect(0, 0, surface.rect.width, surface.rect.height);\n   }\n   ctx.font = this.sampleSurface.context.font;\n   ctx.textBaseline = this.sampleSurface.context.textBaseline;\n   ctx.textAlign = this.sampleSurface.context.textAlign;\n   ctx.fillStyle = ctx.strokeStyle = color || \"#000000\";\n   ctx.fillText(text, 0, surface.rect.height, surface.rect.width);\n   ctx.restore();\n   return surface;\n};\n\n/**\n * Determine the width and height of the given text if rendered\n * with this Font.\n * @param {String} text the text to measure\n * @returns {Array} the [width, height] of the text if rendered with this Font\n */\nFont.prototype.size = function(text) {\n   var metrics = this.sampleSurface.context.measureText(text);\n   // FIXME measuretext is buggy, make extra wide\n   return [metrics.width, this.fontHeight];\n};\n\n/**\n * Height of the font in pixels.\n */\nobjects.accessors(Font.prototype, {\n   'fontHeight': {\n      get: function() {\n         // Returns an approximate line height of the text\n         // This version of the specification does not provide a way to obtain\n         // the bounding box dimensions of the text.\n         // see http://www.whatwg.org/specs/web-apps/current-work/multipage/the-canvas-element.html#dom-context-2d-measuretext\n         return this.sampleSurface.context.measureText('M').width * 1.5;\n      }\n   }\n\n});\n","/**\n * @fileoverview Make synchronous http requests to your game's serverside component.\n *\n * If you configure a ajax base URL you can make http requests to your\n * server using those functions.\n\n * The most high-level functions are `load()` and `save()` which take\n * and return a JavaScript object, which they will send to / recieve from\n * the server-side in JSON format.\n *\n *\n */\n\n/**\n * Response object returned by http functions `get` and `post`. This\n * class is not instantiable.\n *\n * @param{String} responseText\n * @param {String} responseXML\n * @param {Number} status\n * @param {String} statusText\n */\nexports.Response = function() {\n   /**\n    * @param {String} header\n    */\n   this.getResponseHeader = function(header)  {\n   };\n   throw new Error('response class not instantiable');\n};\n\n/**\n * Make http request to server-side\n * @param {String} method http method\n * @param {String} url\n * @param {String|Object} data\n * @param {String|Object} type \"Accept\" header value\n * @return {Response} response\n */\nvar ajax = exports.ajax = function(method, url, data, type) {\n   data = data || null;\n   var response = new XMLHttpRequest();\n   response.open(method, url, false);\n   if (type) {\n      response.setRequestHeader(\"Accept\", type);\n   }\n   if (data instanceof Object) {\n      data = JSON.stringify(data);\n      response.setRequestHeader('Content-Type', 'application/json');\n   }\n   response.setRequestHeader('X-Requested-With', 'XMLHttpRequest');\n   response.send(data);\n   return response;\n};\n\n/**\n * Make http GET request to server-side\n * @param {String} url\n */\nvar get = exports.get = function(url) {\n   return ajax('GET', url);\n};\n\n/**\n * Make http POST request to server-side\n * @param {String} url\n * @param {String|Object} data\n * @param {String|Object} type \"Accept\" header value\n * @returns {Response}\n */\nvar post = exports.post = function(url, data, type) {\n   return ajax('POST', url, data, type);\n};\n\nfunction stringify(response) {\n   /* jshint ignore:start */\n   return eval('(' + response.responseText + ')');\n   /* jshint ignore:end */\n}\n\nfunction ajaxBaseHref() {\n    return (window.$g && window.$g.ajaxBaseHref) || './';\n}\n\n/**\n * Load an object from the server-side.\n * @param {String} url\n * @return {Object} the object loaded from the server\n */\nexports.load = function(url) {\n   return stringify(get(ajaxBaseHref() + url));\n};\n\n/**\n * Send an object to a server-side function.\n * @param {String} url\n * @param {String|Object} data\n * @param {String|Object} type \"Accept\" header value\n * @returns {Object} the response object\n */\nexports.save = function(url, data, type) {\n   return stringify(post(ajaxBaseHref() + url, {payload: data}, type));\n};\n","var gamejs = require('../gamejs');\n\n/**\n * @fileoverview Load images as Surfaces.\n *\n * Sounds & Images are loaded relative to your game's html page\n * (the html which includes the GameJs code) or relative to the\n * property `window.$g.resourceBaseHref`\n * if it is set.\n *\n *\n */\n\nvar CACHE = {};\n\n/**\n * need to export preloading status for require\n * @ignore\n */\nvar _PRELOADING = false;\n\n/**\n * Load image and return it on a Surface.\n *\n * All images must be preloaded before they can be used.\n * @example\n\n *     gamejs.preload([\"./images/ship.png\", \"./images/sunflower.png\"]);\n *     // ...later...\n *     display.blit(gamejs.image.load('images/ship.png'))\n *\n * @param {String|dom.Image} uriOrImage resource uri for image\n * @returns {gamejs.graphics.Surface} surface with the image on it.\n */\nexports.load = function(key) {\n   var img;\n   if (typeof key === 'string') {\n      img = CACHE[key];\n      if (!img) {\n\t\t\tthrow new Error('Missing \"' + key + '\", gamejs.preload() all images before trying to load them.');\n      }\n   } else {\n      img = key;\n   }\n   var canvas = document.createElement('canvas');\n   // IEFIX missing html5 feature naturalWidth/Height\n   canvas.width = img.naturalWidth || img.width;\n   canvas.height = img.naturalHeight || img.height;\n   var context = canvas.getContext('2d');\n   context.drawImage(img, 0, 0);\n   img.getSize = function() { return [img.naturalWidth, img.naturalHeight]; };\n   var surface = new gamejs.graphics.Surface(img.getSize());\n   // NOTE hack setting protected _canvas directly\n   surface._canvas = canvas;\n   surface._context = context;\n   return surface;\n};\n\n\n/**\n * add all images on the currrent page into cache\n * @ignore\n */\nexports.init = function() {\n   return;\n};\n\n/**\n * preload the given img URIs\n * @returns {Function} which returns 0-1 for preload progress\n * @ignore\n */\nexports.preload = function(imgIdents) {\n\n   var countLoaded = 0;\n   var countTotal = 0;\n\n   function incrementLoaded() {\n      countLoaded++;\n      if (countLoaded == countTotal) {\n         _PRELOADING = false;\n      }\n      if (countLoaded % 10 === 0) {\n         gamejs.logging.debug('gamejs.image: preloaded  ' + countLoaded + ' of ' + countTotal);\n      }\n   }\n\n   function getProgress() {\n      return countTotal > 0 ? countLoaded / countTotal : 1;\n   }\n\n   function successHandler() {\n      addToCache(this);\n      incrementLoaded();\n   }\n   function errorHandler() {\n      incrementLoaded();\n      throw new Error('Error loading ' + this.src);\n   }\n\n   var key;\n   for (key in imgIdents) {\n      var lowerKey = key.toLowerCase();\n      if (lowerKey.indexOf('.png') == -1 &&\n            lowerKey.indexOf('.jpg') == -1 &&\n            lowerKey.indexOf('.jpeg') == -1 &&\n            lowerKey.indexOf('.svg') == -1 &&\n            lowerKey.indexOf('.gif') == -1) {\n         continue;\n      }\n      var img = new Image();\n      img.addEventListener('load', successHandler, true);\n      img.addEventListener('error', errorHandler, true);\n      img.src = imgIdents[key];\n      img.gamejsKey = key;\n      countTotal++;\n   }\n   if (countTotal > 0) {\n      _PRELOADING = true;\n   }\n   return getProgress;\n};\n\n/**\n * add the given <img> dom elements into the cache.\n * @private\n */\nvar addToCache = function(img) {\n   CACHE[img.gamejsKey] = img;\n   return;\n};\n","var gamejs = require('../gamejs');\n\n/**\n * @fileoverview Playing sounds with the html5 audio tag. Audio files must be preloaded\n * with the usual `gamejs.preload()` function. Ogg, wav and webm supported.\n *\n */\n\nvar CACHE = {};\n\n/**\n * need to export preloading status for require\n * @ignore\n */\nvar _PRELOADING = false;\n\n/**\n * @ignore\n */\nvar NUM_CHANNELS = 8;\n\n/**\n * Sets the number of available channels for the mixer. The default value is 8.\n */\nexports.setNumChannels = function(count) {\n   NUM_CHANNELS = parseInt(count, 10) || NUM_CHANNELS;\n};\n\nexports.getNumChannels = function() {\n   return NUM_CHANNELS;\n};\n\n/**\n * put all audios on page in cache\n * if same domain as current page, remove common href-prefix\n * @ignore\n */\nexports.init = function() {\n   var audios = Array.prototype.slice.call(document.getElementsByTagName(\"audio\"), 0);\n   addToCache(audios);\n   return;\n};\n\n/**\n * Preload the audios into cache\n * @param {String[]} List of audio URIs to load\n * @returns {Function} which returns 0-1 for preload progress\n * @ignore\n */\nexports.preload = function(audioUrls, showProgressOrImage) {\n   var countTotal = 0;\n   var countLoaded = 0;\n\n   function incrementLoaded() {\n      countLoaded++;\n      if (countLoaded == countTotal) {\n         _PRELOADING = false;\n      }\n   }\n\n   function getProgress() {\n      return countTotal > 0 ? countLoaded / countTotal : 1;\n   }\n\n   function successHandler() {\n      addToCache(this);\n      incrementLoaded();\n   }\n   function errorHandler() {\n      incrementLoaded();\n      throw new Error('Error loading ' + this.src);\n   }\n\n   for (var key in audioUrls) {\n      if (key.indexOf('wav') == -1 && key.indexOf('ogg') == -1 && key.indexOf('webm') == -1) {\n         continue;\n      }\n      countTotal++;\n      var audio = new Audio();\n      audio.addEventListener('canplay', successHandler, true);\n      audio.addEventListener('error', errorHandler, true);\n      audio.src = audioUrls[key];\n      audio.gamejsKey = key;\n      audio.load();\n   }\n   if (countTotal > 0) {\n      _PRELOADING = true;\n   }\n   return getProgress;\n};\n\n/**\n * @ignore\n */\nexports.isPreloading = function() {\n   return _PRELOADING;\n};\n\n/**\n * @param {dom.ImgElement} audios the <audio> elements to put into cache\n * @ignore\n */\nfunction addToCache(audios) {\n   if (!(audios instanceof Array)) {\n      audios = [audios];\n   }\n\n   var docLoc = document.location.href;\n   audios.forEach(function(audio) {\n      CACHE[audio.gamejsKey] = audio;\n   });\n   return;\n}\n\n/**\n * Sounds can be played back.\n * @constructor\n * @param {String|dom.AudioElement} uriOrAudio the uri of <audio> dom element\n *                of the sound\n */\nexports.Sound = function Sound(uriOrAudio) {\n   var cachedAudio;\n   if (typeof uriOrAudio === 'string') {\n      cachedAudio = CACHE[uriOrAudio];\n   } else {\n      cachedAudio = uriOrAudio;\n   }\n   if (!cachedAudio) {\n      // TODO sync audio loading\n      throw new Error('Missing \"' + uriOrAudio + '\", gamejs.preload() all audio files before loading');\n   }\n\n   var channels = [];\n   var i = NUM_CHANNELS;\n   while (i-->0) {\n      var audio = new Audio();\n      audio.preload = \"auto\";\n      audio.loop = false;\n      audio.src = cachedAudio.src;\n      channels.push(audio);\n   }\n   /**\n    * start the sound\n    * @param {Boolean} loop whether the audio should loop for ever or not\n    */\n   this.play = function(loop) {\n      channels.some(function(audio) {\n         if (audio.ended || audio.paused) {\n            audio.loop = !!loop;\n            audio.play();\n            return true;\n         }\n         return false;\n      });\n   };\n\n   /**\n    * Stop the sound.\n    * This will stop the playback of this Sound on any active Channels.\n    */\n   this.stop = function() {\n      channels.forEach(function(audio) {\n         audio.stop();\n      });\n   };\n\n   /**\n    * Set volume of this sound\n    * @param {Number} value volume from 0 to 1\n    */\n   this.setVolume = function(value) {\n      channels.forEach(function(audio) {\n         audio.volume = value;\n      });\n   };\n\n   /**\n    * @returns {Number} the sound's volume from 0 to 1\n    */\n   this.getVolume = function() {\n      return channels[0].volume;\n   };\n\n   /**\n    * @returns {Number} Duration of this sound in seconds\n    */\n   this.getLength = function() {\n      return channels[0].duration;\n   };\n\n   return this;\n};\n","\n/**\n * @fileoverview Static methods for logging and setting the log level. All logging functions (`info()`, `debug()`, etc.) take\n * any number of arguments and will print them in one line.\n *\n */\n\nvar DEBUG_LEVELS = ['debug', 'info', 'warn', 'error', 'fatal'];\nvar debugLevel = 2;\nvar gamejs = require('../gamejs');\n\n/**\n * set logLevel as string or number\n *   * 0 = info\n *   * 1 = warn\n *   * 2 = error\n *   * 3 = fatal\n *\n * @example\n * gamejs.setLogLevel(0); // debug\n * gamejs.setLogLevel('error'); // equal to setLogLevel(2)\n */\nexports.setLogLevel = function(logLevel) {\n   if (typeof logLevel === 'string' && DEBUG_LEVELS.indexOf(logLevel)) {\n      debugLevel = DEBUG_LEVELS.indexOf(logLevel);\n   } else if (typeof logLevel === 'number') {\n      debugLevel = logLevel;\n   } else {\n      throw new Error('invalid logLevel ', logLevel, ' Must be one of: ', DEBUG_LEVELS);\n   }\n   return debugLevel;\n};\n\n/**\n * Log a msg to the console if console is enable\n * @param {String} message,... the msg to log\n */\nvar log = exports.log = function() {\n\n   if (gamejs.thread.inWorker === true) {\n      gamejs.thread._logMessage.apply(null, arguments);\n      return;\n   }\n\n   // IEFIX can't call apply on console\n   var args = Array.prototype.slice.apply(arguments, [0]);\n   args.unshift(Date.now());\n   if (window.console !== undefined && console.log.apply) {\n      console.log.apply(console, args);\n   }\n};\n/**\n * @param {String} message,... to log\n */\nexports.debug = function() {\n   if (debugLevel <= DEBUG_LEVELS.indexOf('debug')) {\n      log.apply(this, arguments);\n   }\n};\n/**\n * @param {String} message,... to log\n */\nexports.info = function() {\n   if (debugLevel <= DEBUG_LEVELS.indexOf('info')) {\n      log.apply(this, arguments);\n   }\n};\n/**\n * @param {String} message,... to log\n */\nexports.warn = function() {\n   if (debugLevel <= DEBUG_LEVELS.indexOf('warn')) {\n      log.apply(this, arguments);\n   }\n};\n/**\n * @param {String} message,... to log\n */\nexports.error = function() {\n   if (debugLevel <= DEBUG_LEVELS.indexOf('error')) {\n      log.apply(this, arguments);\n   }\n};\n/**\n * @param {String} message to log\n */\nexports.fatal = function() {\n   if (debugLevel <= DEBUG_LEVELS.indexOf('fatal')) {\n      log.apply(this, arguments);\n   }\n};\n","/**\n * @fileoverview Binary Heap implementation from Eloquent JavaScript\n *\n * @see http://eloquentjavascript.net/appendix2.html\n */\nvar BinaryHeap = exports.BinaryHeap = function(scoreFunction){\n   /**\n    * @ignore\n    */\n   this.content = [];\n   /**\n    * @ignore\n    */\n   this.scoreFunction = scoreFunction;\n   return this;\n};\n\n/**\n * Add element to heap.\n * @param {Object} element\n */\nBinaryHeap.prototype.push = function(element) {\n   this.content.push(element);\n   this.sinkDown(this.content.length - 1);\n   return;\n};\n\n/**\n * Return first element from heap.\n * @param {Object} element\n * @returns {Object} element\n */\nBinaryHeap.prototype.pop = function() {\n   // Store the first element so we can return it later.\n   var result = this.content[0];\n   // Get the element at the end of the array.\n   var end = this.content.pop();\n   // If there are any elements left, put the end element at the\n   // start, and let it bubble up.\n   if (this.content.length > 0) {\n      this.content[0] = end;\n      this.bubbleUp(0);\n   }\n   return result;\n};\n\n/**\n * Remove the given element from the heap.\n * @param {Object} element\n * @throws {Error} if node not found\n * @returns true if the node was round and removed or fals otherwise\n */\nBinaryHeap.prototype.remove = function(node) {\n   // To remove a value, we must search through the array to find\n   // it.\n   var isFound = this.content.some(function(cNode, idx) {\n      if (cNode == node) {\n         var end = this.content.pop();\n         if (idx != this.content.length) {\n            this.content[idx] = end;\n            if (this.scoreFunction(end) < this.scoreFunction(node)) {\n               this.sinkDown(idx);\n            } else {\n               this.bubbleUp(idx);\n            }\n         }\n         return true;\n      }\n      return false;\n   }, this);\n   return isFound;\n};\n\n/**\n * Number of elements in heap.\n */\nBinaryHeap.prototype.size = function() {\n   return this.content.length;\n};\n\n/**\n * @ignore\n */\nBinaryHeap.prototype.sinkDown = function(idx) {\n   // Fetch the element that has to be sunk\n   var element = this.content[idx];\n   // When at 0, an element can not sink any further.\n   while (idx > 0) {\n      // Compute the parent element's index, and fetch it.\n      var parentIdx = Math.floor((idx + 1) / 2) - 1;\n      var parent = this.content[parentIdx];\n      // Swap the elements if the parent is greater.\n      if (this.scoreFunction(element) < this.scoreFunction(parent)) {\n         this.content[parentIdx] = element;\n         this.content[idx] = parent;\n         // Update 'n' to continue at the new position.\n         idx = parentIdx;\n      // Found a parent that is less, no need to sink any further.\n      } else {\n         break;\n      }\n   }\n   return;\n};\n\n/**\n * @ignore\n */\nBinaryHeap.prototype.bubbleUp = function(idx) {\n   // Look up the target element and its score.\n   var length = this.content.length;\n   var element = this.content[idx];\n   var elemScore = this.scoreFunction(element);\n\n   while(true) {\n      // Compute the indices of the child elements.\n      var child2Idx = (idx + 1) * 2;\n      var child1Idx= child2Idx - 1;\n      // This is used to store the new position of the element,\n      // if any.\n      var swapIdx = null;\n      // If the first child exists (is inside the array)...\n      var child1Score;\n      if (child1Idx < length) {\n         // Look it up and compute its score.\n         var child1 = this.content[child1Idx];\n         child1Score = this.scoreFunction(child1);\n         // If the score is less than our element's, we need to swap.\n         if (child1Score < elemScore) {\n            swapIdx = child1Idx;\n         }\n      }\n      // Do the same checks for the other child.\n      if (child2Idx < length) {\n         var child2 = this.content[child2Idx];\n         var child2Score = this.scoreFunction(child2);\n         if (child2Score < (swapIdx === null ? elemScore : child1Score)) {\n            swapIdx = child2Idx;\n         }\n      }\n\n      // If the element needs to be moved, swap it, and continue.\n      if (swapIdx !== null) {\n         this.content[idx] = this.content[swapIdx];\n         this.content[swapIdx] = element;\n         idx = swapIdx;\n      // Otherwise, we are done.\n      } else {\n         break;\n      }\n   }\n   return;\n};\n","/**\n * @fileoverview A seedable random-number generator.\n *\n * A generator is initialized by GameJs and can be used with the\n * static functions of this module:\n *\n *    gamejs.random.choose([1,2,4]);\n *    // integet between and including 2 and 5\n *    gamejs.random.integer(2, 5);\n *\n * You can re-initialize this generator with a different seed by\n * calling `gamejs.utils.prng.init(seed)` after which the static\n * functions in this module will use the new seed.\n *\n * @usage\n *  var prng = require('gamejs/math/random');\n *  prng.random(); // 0.6765871671959758\n *  prng.integer(2, 10); // 5\n *  prng.choose([1,2,3,4,5]); // 3\n */\n// From http://baagoe.com/en/RandomMusings/javascript/\n// Johannes Baage <baagoe@baagoe.com>, 2010\n// API modified by Simon Oberhammer <simon@nekapuzer.at>, 2012\n// discussion of the used algorithms <http://baagoe.org/en/w/index.php/Better_random_numbers_for_javascript>\n\n\n/** @ignore **/\nvar Mash = function Mash() {\n  var n = 0xefc8249d;\n  this.hash = function(data) {\n    data = data.toString();\n    var i;\n    for (i = 0; i < data.length; i++) {\n      n += data.charCodeAt(i);\n      var h = 0.02519603282416938 * n;\n      n = h >>> 0;\n      h -= n;\n      h *= n;\n      n = h >>> 0;\n      h -= n;\n      n += h * 0x100000000; // 2^32\n    }\n    return (n >>> 0) * 2.3283064365386963e-10; // 2^-32\n  };\n\n  this.version = 'Mash 0.9';\n  return this;\n};\n\n/**\n * A seedable pseudo-random number generator.\n * @param {Number|String} seed the seed for generating the numbers\n *\n * @usage\n *  var prng = require('gamejs/math/random');\n *  var seed = 'gamejs';\n *  var alea = new prng.Alea(seed);\n *  alea.random(); // 0.6765871671959758\n *  alea.random(); // 0.15881546027958393\n *\n *  // generator with the same seed will generate the same sequence\n *  // of numbers:\n *  var aleaTwo = new prng.Alea(seed);\n *  aleaTwo.random(); // 0.6765871671959758\n *  aleaTwo.random(); // 0.15881546027958393\n */\nvar Alea = exports.Alea = function Alea() {\n   var args = Array.prototype.slice.call(arguments);\n   var s0 = 0;\n   var s1 = 0;\n   var s2 = 0;\n   var c = 1;\n   if (args.length === 0 || !args[0]) {\n     args = [Date.now()];\n   }\n   var mash = new Mash();\n   s0 = mash.hash(' ');\n   s1 = mash.hash(' ');\n   s2 = mash.hash(' ');\n\n   var i;\n   for (i = 0; i < args.length; i++) {\n     s0 -= mash.hash(args[i]);\n     if (s0 < 0) {\n       s0 += 1;\n     }\n     s1 -= mash.hash(args[i]);\n     if (s1 < 0) {\n       s1 += 1;\n     }\n     s2 -= mash.hash(args[i]);\n     if (s2 < 0) {\n       s2 += 1;\n     }\n   }\n   mash = null;\n\n   /**\n    * @returns {Number} the next random number as determined by the seed\n    */\n   this.random = function() {\n     var t = 2091639 * s0 + c * 2.3283064365386963e-10; // 2^-32\n     s0 = s1;\n     s1 = s2;\n     s2 = t - (c = t | 0);\n     return s2;\n   };\n   this.integer = function(min, max) {\n     return min + parseInt(this.random() * (max-min+1), 10);\n   };\n   this.vector = function(min, max) {\n      return [this.integer(min[0], max[0]), this.integer(min[1], max[1])];\n   };\n   this.choose = function(items) {\n      return items[this.integer(0, items.length-1)];\n   };\n   return this;\n};\n\n// alea instance per gamejs instance\nvar alea = null;\n\n/**\n * @param {Number} min\n * @param {Number} max\n * @returns {Number} random integer between min and max\n */\nvar integer = exports.integer = function(min, max){\n    return alea.integer(min, max);\n};\n\n/**\n * @param {Array} minVector 2 integers, the minimum vector\n * @param {Array} maxVector 2 integers, the maximum vector\n * @returns {Array} a random vector [min[0]<=x<=max[0], min[1]<=y<=max[1]]\n */\nexports.vector = function(min, max){\n    return alea.vector(min, max);\n};\n\n/**\n * @param {Array} items\n * @returns {Object} random item from items list\n */\nexports.choose = function(items){\n    return alea.choose(items);\n};\n\n/**\n * @returns {Number} next random float between 0 and 1\n */\nexports.random = function() {\n  return alea.random();\n};\n\n/**\n * Re-initialize the per instance random number generator used\n * in the static functions on this module (e.g. vector())\n * @param {Number|String} seed\n */\nexports.init = function(seed) {\n  alea = new Alea(seed);\n};","/**\n * @fileoverview\n * A noise generator comparable to Perlin noise, which is useful\n * for generating procedural content.\n *\n * This implementation provides 2D and 3D noise:\n *\n *    var simplex = new Simplex();\n *    simplex.get(2, 4);\n *    simple.get3d(1, 2, 4);\n *\n * You can optionally\n * pass a seedable pseudo-random number generator to its constructor. This\n * generator object is assumed to have a `random()` method; `Math` is used\n * per default:\n *\n *     var Alea = require('gamejs/math/random').Alea;\n *     var simplex = new Simplex(new Alea());\n *\n * Also see `gamejs/math/random` for a seedable pseudo random number generator\n *\n * @see gamejs/utils/prng\n */\n\n// Ported to JS by by zz85 <https://github.com/zz85> from Stefan\n// Gustavson's java implementation\n// <http://staffwww.itn.liu.se/~stegu/simplexnoise/simplexnoise.pdf>\n// Read Stefan's excellent paper for details on how this code works.\n//\n// Sean McCullough banksean@gmail.com\n\n/**\n * @param {Object} randomNumberGenerator the random number generator to use; most provide `random()` method\n * @usage\n *  var simplex = new gamejs.noise.Simplex();\n *  simplex.get(x, y);\n *  // or for 3d noise\n *  simple.get(x, y, y);\n */\n\nvar Simplex = exports.Simplex = function(r) {\n  if (r === undefined) {\n    r = Math;\n  }\n  /** @ignore */\n  this.grad3 = [[1,1,0],[-1,1,0],[1,-1,0],[-1,-1,0],\n               [1,0,1],[-1,0,1],[1,0,-1],[-1,0,-1],\n               [0,1,1],[0,-1,1],[0,1,-1],[0,-1,-1]];\n  /** @ignore */\n  this.p = [];\n  var i;\n  for (i=0; i<256; i++) {\n   this.p[i] = Math.floor(r.random()*256);\n  }\n  // To remove the need for index wrapping, double the permutation table length\n  /** @ignore */\n  this.perm = [];\n  for(i=0; i<512; i++) {\n    this.perm[i]=this.p[i & 255];\n  }\n\n  // A lookup table to traverse the simplex around a given point in 4D.\n  // Details can be found where this table is used, in the 4D noise method.\n  /** @ignore */\n  this.simplex = [\n    [0,1,2,3],[0,1,3,2],[0,0,0,0],[0,2,3,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,2,3,0],\n    [0,2,1,3],[0,0,0,0],[0,3,1,2],[0,3,2,1],[0,0,0,0],[0,0,0,0],[0,0,0,0],[1,3,2,0],\n    [0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],\n    [1,2,0,3],[0,0,0,0],[1,3,0,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,3,0,1],[2,3,1,0],\n    [1,0,2,3],[1,0,3,2],[0,0,0,0],[0,0,0,0],[0,0,0,0],[2,0,3,1],[0,0,0,0],[2,1,3,0],\n    [0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0],\n    [2,0,1,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,0,1,2],[3,0,2,1],[0,0,0,0],[3,1,2,0],\n    [2,1,0,3],[0,0,0,0],[0,0,0,0],[0,0,0,0],[3,1,0,2],[0,0,0,0],[3,2,0,1],[3,2,1,0]];\n};\n\n/** @ignore */\nSimplex.prototype.dot = function(g, x, y) {\n   return g[0]*x + g[1]*y;\n};\n\n/**\n * @param {Number} x\n * @param {Number} y\n * @returns {Number} noise for given position, in range [-1, 1]\n */\nSimplex.prototype.get = function(xin, yin) {\n  var n0, n1, n2; // Noise contributions from the three corners\n  // Skew the input space to determine which simplex cell we're in\n  var F2 = 0.5*(Math.sqrt(3.0)-1.0);\n  var s = (xin+yin)*F2; // Hairy factor for 2D\n  var i = Math.floor(xin+s);\n  var j = Math.floor(yin+s);\n  var G2 = (3.0-Math.sqrt(3.0))/6.0;\n  var t = (i+j)*G2;\n  var X0 = i-t; // Unskew the cell origin back to (x,y) space\n  var Y0 = j-t;\n  var x0 = xin-X0; // The x,y distances from the cell origin\n  var y0 = yin-Y0;\n  // For the 2D case, the simplex shape is an equilateral triangle.\n  // Determine which simplex we are in.\n  var i1, j1; // Offsets for second (middle) corner of simplex in (i,j) coords\n  if(x0>y0) {i1=1; j1=0;} // lower triangle, XY order: (0,0)->(1,0)->(1,1)\n  else {i1=0; j1=1;} // upper triangle, YX order: (0,0)->(0,1)->(1,1)\n  // A step of (1,0) in (i,j) means a step of (1-c,-c) in (x,y), and\n  // a step of (0,1) in (i,j) means a step of (-c,1-c) in (x,y), where\n  // c = (3-sqrt(3))/6\n  var x1 = x0 - i1 + G2; // Offsets for middle corner in (x,y) unskewed coords\n  var y1 = y0 - j1 + G2;\n  var x2 = x0 - 1.0 + 2.0 * G2; // Offsets for last corner in (x,y) unskewed coords\n  var y2 = y0 - 1.0 + 2.0 * G2;\n  // Work out the hashed gradient indices of the three simplex corners\n  var ii = i & 255;\n  var jj = j & 255;\n  var gi0 = this.perm[ii+this.perm[jj]] % 12;\n  var gi1 = this.perm[ii+i1+this.perm[jj+j1]] % 12;\n  var gi2 = this.perm[ii+1+this.perm[jj+1]] % 12;\n  // Calculate the contribution from the three corners\n  var t0 = 0.5 - x0*x0-y0*y0;\n  if(t0<0) {\n    n0 = 0.0;\n  } else {\n    t0 *= t0;\n    n0 = t0 * t0 * this.dot(this.grad3[gi0], x0, y0); // (x,y) of grad3 used for 2D gradient\n  }\n  var t1 = 0.5 - x1*x1-y1*y1;\n  if(t1<0) {\n    n1 = 0.0;\n  } else {\n    t1 *= t1;\n    n1 = t1 * t1 * this.dot(this.grad3[gi1], x1, y1);\n  }\n  var t2 = 0.5 - x2*x2-y2*y2;\n  if(t2<0) {\n    n2 = 0.0;\n  } else {\n    t2 *= t2;\n    n2 = t2 * t2 * this.dot(this.grad3[gi2], x2, y2);\n  }\n  // Add contributions from each corner to get the final noise value.\n  // The result is scaled to return values in the interval [-1,1].\n  return 70.0 * (n0 + n1 + n2);\n};\n\n\n/**\n * @param {Number} x\n * @param {Number} y\n * @param {Number} y\n * @returns {Number} noise for given position, in range [-1, 1]\n */\nSimplex.prototype.get3d = function(xin, yin, zin) {\n  var n0, n1, n2, n3; // Noise contributions from the four corners\n  // Skew the input space to determine which simplex cell we're in\n  var F3 = 1.0/3.0;\n  var s = (xin+yin+zin)*F3; // Very nice and simple skew factor for 3D\n  var i = Math.floor(xin+s);\n  var j = Math.floor(yin+s);\n  var k = Math.floor(zin+s);\n  var G3 = 1.0/6.0; // Very nice and simple unskew factor, too\n  var t = (i+j+k)*G3;\n  var X0 = i-t; // Unskew the cell origin back to (x,y,z) space\n  var Y0 = j-t;\n  var Z0 = k-t;\n  var x0 = xin-X0; // The x,y,z distances from the cell origin\n  var y0 = yin-Y0;\n  var z0 = zin-Z0;\n  // For the 3D case, the simplex shape is a slightly irregular tetrahedron.\n  // Determine which simplex we are in.\n  var i1, j1, k1; // Offsets for second corner of simplex in (i,j,k) coords\n  var i2, j2, k2; // Offsets for third corner of simplex in (i,j,k) coords\n  if(x0>=y0) {\n    if(y0>=z0)\n      { i1=1; j1=0; k1=0; i2=1; j2=1; k2=0; } // X Y Z order\n      else if(x0>=z0) { i1=1; j1=0; k1=0; i2=1; j2=0; k2=1; } // X Z Y order\n      else { i1=0; j1=0; k1=1; i2=1; j2=0; k2=1; } // Z X Y order\n    }\n  else { // x0<y0\n    if(y0<z0) { i1=0; j1=0; k1=1; i2=0; j2=1; k2=1; } // Z Y X order\n    else if(x0<z0) { i1=0; j1=1; k1=0; i2=0; j2=1; k2=1; } // Y Z X order\n    else { i1=0; j1=1; k1=0; i2=1; j2=1; k2=0; } // Y X Z order\n  }\n  // A step of (1,0,0) in (i,j,k) means a step of (1-c,-c,-c) in (x,y,z),\n  // a step of (0,1,0) in (i,j,k) means a step of (-c,1-c,-c) in (x,y,z), and\n  // a step of (0,0,1) in (i,j,k) means a step of (-c,-c,1-c) in (x,y,z), where\n  // c = 1/6.\n  var x1 = x0 - i1 + G3; // Offsets for second corner in (x,y,z) coords\n  var y1 = y0 - j1 + G3;\n  var z1 = z0 - k1 + G3;\n  var x2 = x0 - i2 + 2.0*G3; // Offsets for third corner in (x,y,z) coords\n  var y2 = y0 - j2 + 2.0*G3;\n  var z2 = z0 - k2 + 2.0*G3;\n  var x3 = x0 - 1.0 + 3.0*G3; // Offsets for last corner in (x,y,z) coords\n  var y3 = y0 - 1.0 + 3.0*G3;\n  var z3 = z0 - 1.0 + 3.0*G3;\n  // Work out the hashed gradient indices of the four simplex corners\n  var ii = i & 255;\n  var jj = j & 255;\n  var kk = k & 255;\n  var gi0 = this.perm[ii+this.perm[jj+this.perm[kk]]] % 12;\n  var gi1 = this.perm[ii+i1+this.perm[jj+j1+this.perm[kk+k1]]] % 12;\n  var gi2 = this.perm[ii+i2+this.perm[jj+j2+this.perm[kk+k2]]] % 12;\n  var gi3 = this.perm[ii+1+this.perm[jj+1+this.perm[kk+1]]] % 12;\n  // Calculate the contribution from the four corners\n  var t0 = 0.6 - x0*x0 - y0*y0 - z0*z0;\n  if(t0<0) {\n    n0 = 0.0;\n  } else {\n    t0 *= t0;\n    n0 = t0 * t0 * this.dot(this.grad3[gi0], x0, y0, z0);\n  }\n  var t1 = 0.6 - x1*x1 - y1*y1 - z1*z1;\n  if(t1<0) {\n    n1 = 0.0;\n  } else {\n    t1 *= t1;\n    n1 = t1 * t1 * this.dot(this.grad3[gi1], x1, y1, z1);\n  }\n  var t2 = 0.6 - x2*x2 - y2*y2 - z2*z2;\n  if(t2<0) {\n    n2 = 0.0;\n  } else {\n    t2 *= t2;\n    n2 = t2 * t2 * this.dot(this.grad3[gi2], x2, y2, z2);\n  }\n  var t3 = 0.6 - x3*x3 - y3*y3 - z3*z3;\n  if(t3<0) {\n    n3 = 0.0;\n  } else {\n    t3 *= t3;\n    n3 = t3 * t3 * this.dot(this.grad3[gi3], x3, y3, z3);\n  }\n  // Add contributions from each corner to get the final noise value.\n  // The result is scaled to stay just inside [-1,1]\n  return 32.0*(n0 + n1 + n2 + n3);\n};\n","/**\n * @fileoverview Utility functions for working with Obiects\n * @param {Object} item\n * @param {Array} array\n * @param {Object} returns removed item or null\n */\n\nexports.remove = function(item, array) {\n   var index = array.indexOf(item);\n   if (index !== -1) {\n      return array.splice(array.indexOf(item), 1);\n   }\n   return null;\n};\n\n/**\n * Shuffles the array *in place*.\n * @see http://en.wikipedia.org/wiki/Fisher%E2%80%93Yates_shuffle\n */\nexports.shuffle = function(array) {\n    var len = array.length -1;\n    for (var i = len; i > 0; i--) {\n        var idx = parseInt(Math.random() * (i + 1), 10);\n        var item = array[i];\n        array[i] = array[idx];\n        array[idx] = item;\n    }\n    return array;\n};\n","/**\n * @fileoverview Working with strings\n */\n\n/**\n * Get the longest common segment that two strings\n * have in common, starting at the beginning of the string\n * @param {String} str1 a string\n * @param {String} str2 another string\n * @returns {String} the longest common segment\n */\nexports.getCommonPrefix = function getCommonPrefix(str1, str2) {\n    if (str1 === null || str2 === null) {\n        return null;\n    } else if (str1.length > str2.length && str1.indexOf(str2) === 0) {\n        return str2;\n    } else if (str2.length > str1.length && str2.indexOf(str1) === 0) {\n        return str1;\n    }\n    var length = Math.min(str1.length, str2.length);\n    var i;\n    for (i = 0; i < length; i++) {\n        if (str1[i] != str2[i]) {\n            return str1.slice(0, i);\n        }\n    }\n    return str1.slice(0, length);\n};","/**\n * @fileoverview\n *\n * Provides facilities for parsing a xml String.\n *\n * You will typically get a `gamejs.xml.Document` instance\n * by loading the data with one of the two static\n * `Document.fromString(string)` or `Document.fromUrl(url)`.\n\n * Querying for `elements(name)` or `children()` will return a\n * new `gamejs.xml.Document` matching your result (or null).\n *\n * Use `attributes(name)` and `value()` to get the data stored\n * in the XML Document.\n */\n\n/**\n * XMLParser\n */\nvar Parser = exports.Parser = function() {\n\n   var xmlDoc = null;\n   var parser = new DOMParser();\n\n   this.parseFromString = function(xmlString) {\n      xmlDoc = parser.parseFromString(xmlString, 'text/xml');\n      return xmlDoc;\n   };\n\n   return this;\n};\n\n/**\n * Instantiate with the static functions `Document.fromString()` and `fromURL()`.\n */\nvar Document = exports.Document = function(xmlDocument) {\n   if (!xmlDocument || (!xmlDocument instanceof XMLDocument) ) {\n      throw new Error('Need a valid xmlDocument.');\n   }\n   /** @ignore **/\n   this._xmlDocument = xmlDocument;\n   return this;\n};\n\n/**\n * Returns the first element in the current document whose tag-name matches\n * the given 'name'.\n * @returns gamejs.xml.Document\n */\nDocument.prototype.element = function(name) {\n   var elem = this._xmlDocument.getElementsByTagName(name)[0];\n   return elem && new Document(elem) || null;\n};\n\n/**\n * Returns all elements in the current document whose tag-name matches\n * the given 'name'.\n * @returns an Array of gamejs.xml.Document\n */\nDocument.prototype.elements = function(name) {\n   var elems = this._xmlDocument.getElementsByTagName(name);\n   return Array.prototype.slice.apply(elems, [0]).map(function(elem) {\n      return new Document(elem);\n   });\n};\n\n/**\n * Returns the attribute value of this document.\n *\n * @returns String\n */\nDocument.prototype.attribute = function(name) {\n   var attributeValue = this._xmlDocument.getAttribute(name);\n   attributeValue = attributeValue ? attributeValue.trim() : null;\n   if (attributeValue === null) {\n      return null;\n   }\n   if (attributeValue.toLowerCase() === 'true') {\n      return true;\n   }\n   if (attributeValue.toLowerCase() === 'false') {\n      return false;\n   }\n   var attributeIntValue = parseInt(attributeValue, 10);\n   var attributeFloatValue = parseFloat(attributeValue, 10);\n   if (!isNaN(attributeIntValue)) {\n      if (attributeFloatValue !== attributeIntValue) {\n         return attributeFloatValue;\n      }\n      return attributeIntValue;\n   }\n   return attributeValue;\n};\n\n/**\n * Returns the nodevalue of the current xml document\n * @returns String\n */\nDocument.prototype.value = function() {\n   return this._xmlDocument.nodeValue;\n};\n\n/**\n * Returns all children of this xml document\n * @returns Array of gamejs.xml.Document\n */\nDocument.prototype.children = function() {\n   return Array.prototype.slice.apply(this._xmlDocument.childNodes, [0]).map(function(cNode) {\n      return new Document(cNode);\n   });\n};\n\n/**\n * @returns gamejs.xml.Document\n */\nDocument.fromString = function(xmlString) {\n   var parser = new DOMParser();\n   var xmlDoc = parser.parseFromString(xmlString, 'text/xml');\n   return new Document(xmlDoc);\n};\n\n/**\n * @returns gamejs.xml.Document\n */\nDocument.fromURL = function(url) {\n   var response = new XMLHttpRequest();\n   response.open('GET', url, false);\n   response.setRequestHeader('X-Requested-With', 'XMLHttpRequest');\n   response.setRequestHeader('Content-Type', 'text/xml');\n   response.overrideMimeType('text/xml');\n   response.send();\n   return new Document(response.responseXML);\n};\n","/**\n * @fileoverview\n * Base64 encode / decode\n * @author http://www.webtoolkit.info\n */\n\n\nvar keyStr = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=\";\n\n/**\n * Decodes a base64 encoded string to a string.\n */\nvar decode = exports.decode = function(input) {\n   var output = [], chr1, chr2, chr3, enc1, enc2, enc3, enc4, i = 0;\n   input = input.replace(/[^A-Za-z0-9\\+\\/\\=]/g, \"\");\n\n   while (i < input.length) {\n      enc1 = keyStr.indexOf(input.charAt(i++));\n      enc2 = keyStr.indexOf(input.charAt(i++));\n      enc3 = keyStr.indexOf(input.charAt(i++));\n      enc4 = keyStr.indexOf(input.charAt(i++));\n\n      chr1 = (enc1 << 2) | (enc2 >> 4);\n      chr2 = ((enc2 & 15) << 4) | (enc3 >> 2);\n      chr3 = ((enc3 & 3) << 6) | enc4;\n\n      output.push(String.fromCharCode(chr1));\n\n      if (enc3 != 64) {\n         output.push(String.fromCharCode(chr2));\n      }\n      if (enc4 != 64) {\n         output.push(String.fromCharCode(chr3));\n      }\n   }\n\n   output = output.join('');\n   return output;\n};\n\n/**\n * Decodes a base64 encoded string into a byte array\n * @param {String} input\n * @param {Array} bytes bytes per character, defaults to 1\n */\nexports.decodeAsArray = function(input, bytes) {\n   bytes = bytes || 1;\n   var decoded = decode(input);\n   var len = decoded.length / bytes;\n   var array = [];\n   var i,j;\n   for (i=0; i< len; i++) {\n      array[i] = 0;\n      for (j = bytes - 1; j >=0; --j) {\n         array[i] += decoded.charCodeAt((i * bytes) + j) << (j <<3 );\n      }\n   }\n   return array;\n}\n;","/**\n * @fileoverview\n * A* path finding algorithm\n *\n * Use the `findRoute(map, from, to, [timeout])` function to get the linked list\n * leading `from` a point `to` another on the given `map`.\n *\n * The map must implement the interface `gamejs.pathfinding.Map`. This\n * class already holds an example implementation for debugging use.\n *\n * Optionally, the search is cancelled after `timeout` in millseconds.\n *\n * If there is no route `null` is returned.\n *\n * @see http://en.wikipedia.org/wiki/A*_search_algorithm\n * @see http://eloquentjavascript.net/chapter7.html\n */\nvar BinaryHeap = require('./math/binaryheap').BinaryHeap;\n\n/**\n * helper function for A*\n */\nfunction ReachedList(hashFn) {\n   var list = {};\n\n   this.store = function(point, route) {\n      list[hashFn(point)] = route;\n      return;\n   };\n\n   this.find = function(point) {\n      return list[hashFn(point)];\n   };\n   return this;\n}\n\n\n/** A* search function.\n *\n * This function expects a `Map` implementation and the origin and destination\n * points given. If there is a path between the two it will return the optimal\n * path as a linked list. If there is no path it will return null.\n *\n * The linked list is in reverse order: the first item is the destination and\n * the path to the origin follows.\n *\n * @param {Map} map map instance, must follow interface defined in {Map}\n * @param {Array} origin\n * @param {Array} destination\n * @param {Number} timeout milliseconds after which search should be canceled\n * @returns {Object} the linked list leading from `to` to `from` (sic!).\n **/\nexports.findRoute = function(map, from, to, timeout) {\n   var open = new BinaryHeap(routeScore);\n   var hashFn = typeof map.hash === 'function' ? map.hash : defaultHash;\n   var reached = new ReachedList(hashFn);\n\n   function routeScore(route) {\n      if (route.score === undefined) {\n         route.score = map.estimatedDistance(route.point, to) + route.length;\n      }\n      return route.score;\n   }\n   function addOpenRoute(route) {\n      open.push(route);\n      reached.store(route.point, route);\n   }\n\n   function processNewPoints(direction) {\n      var known = reached.find(direction);\n      var newLength = route.length + map.actualDistance(route.point, direction);\n      if (!known || known.length > newLength){\n         if (known) {\n            open.remove(known);\n         }\n         addOpenRoute({\n            point: direction,\n            from: route,\n            length: newLength\n         });\n      }\n   }\n   var startMs = Date.now();\n   var route = null;\n   addOpenRoute({\n      point: from,\n      from: null,\n      length: 0\n   });\n   var equalsFn = typeof map.equals === 'function' ? map.equals : defaultEquals;\n   while (open.size() > 0 && (!timeout || Date.now() - startMs < timeout)) {\n      route = open.pop();\n      if (equalsFn(to, route.point)) {\n         return route;\n      }\n      map.adjacent(route.point).forEach(processNewPoints);\n   } // end while\n   return null;\n};\n\nvar defaultEquals = function(a, b) {\n   return a[0] === b[0] && a[1] === b[1];\n};\n\nvar defaultHash = function(a) {\n   return a[0] + '-' + a[1];\n};\n\n/**\n * This is the interface for a Map that can be passed to the `findRoute()`\n * function. `Map` is not instantiable - see the unit tests for an example\n * implementation of Map.\n */\nvar Map = exports.Map = function() {\n   throw new Error('not instantiable, this is an interface');\n};\n\n/**\n * @param {Array} origin\n * @returns {Array} list of points accessible from given Point\n */\nMap.prototype.adjacent = function(origin) {\n};\n\n/**\n * @param {Object} a one of the points ot test for equality\n * @param {Object} b ... the other point\n * @returns Wheter the two points are equal.\n */\nMap.prototype.equals = defaultEquals;\n\n/**\n * @param {Object} a point\n * @returns {String} hash for the point\n */\nMap.prototype.hash = defaultHash;\n\n/**\n * Estimated lower bound distance between two points.\n * @param {Object} pointA\n * @param {Object} pointB\n * @returns {Number} the estimated distance between two points\n */\nMap.prototype.estimatedDistance = function(pointA, pointB) {\n   return 1;\n};\n\n/**\n * Actual distance between two points.\n * @param {Object} pointA\n * @param {Object} pointB\n * @returns {Number} the actual distance between two points\n */\nMap.prototype.actualDistance = function(pointA, pointB) {\n   return 1;\n};\n","var gamejs = require('../gamejs');\nvar objects = require('./utils/objects');\nvar xml = require('./utils/xml');\nvar base64 = require('./utils/base64');\nvar uri = require('./utils/uri');\n\n/**\n * @fileoverview\n * This is a loader for the general purpose tile map editor \"Tiled\".\n *\n * This module can load all \".tmx\" files even if additionally base64 encoded\n * (can be configured in Tiled).\n *\n * This module loads the whole map definition, including the TileSets with\n * all necessary images. For an example on how to render a map loaded with\n * this module, see `examples/tiledmap`.\n *\n * You will typically create a Map instance with `Map(url)` and deal\n * with the layers, tilesets, etc. through the Map instance\n * instead of loading & creating them yourself.\n *\n * Only orthogonol maps are supported (no isometric maps).\n *\n * @see http://www.mapeditor.org/\n * @see https://github.com/bjorn/tiled/wiki/TMX-Map-Format\n */\n\n/**\n * My code is inspired by:\n *   * https://bitbucket.org/maikg/tiled2cocos/\n *   * https://github.com/obiot/melonJS/\n *\n */\n\n/**\n * A Tiled Map holds all layers defined in the tmx file as well\n * as the necessary tiles to render the map.\n * @param {String} url Relative or absolute URL to the tmx file\n */\nvar Map = exports.Map = function(url) {\n\n   url = uri.resolve(document.location.href, url);\n   var xmlDoc = xml.Document.fromURL(url);\n   var mapNode = xmlDoc.element('map');\n\n   /**\n    * Width of a single tile in pixels\n    * @type Number\n    */\n   this.tileWidth = mapNode.attribute('tilewidth');\n   /**\n    * Height of a single tile in pixels\n    * @type Number\n    */\n   this.tileHeight = mapNode.attribute('tileheight');\n   /**\n    * Width of the map in tiles\n    * @type Number\n    */\n   this.width = mapNode.attribute('width');\n   /**\n    * Height of the map in tiles\n    * @type Number\n    */\n   this.height = mapNode.attribute('height');\n\n   var orientation = mapNode.attribute('orientation');\n   if (orientation !== 'orthogonal') {\n      throw new Error('only orthogonol maps supported');\n   }\n\n   /**\n    * Custom properties of the map\n    */\n   this.properties = {};\n   setProperties(this.properties, mapNode);\n\n   /**\n    * All tiles of this map.\n    * @type {TileSet}\n    */\n   this.tiles = new TileSets(mapNode, url);\n   this.layers = loadLayers(mapNode);\n   return this;\n};\n\n/**\n * A Tile. Can not be instantiated. Get a Tile by calling `getTile(gid)`\n * on a `TileSets` instance.\n */\nvar Tile = exports.Tile = function() {\n   /**\n    * @type {gamejs.graphics.Surface}\n    */\n   this.surface = null;\n   /**\n    * @type {Object}\n    */\n   this.properties = null;\n   throw new Error('Can not be instantiated.');\n};\n\n/**\n * A TileSets instance holds all tilesets of a map. This class\n * makes it easy to get the image for a certain tile ID. You usually\n * don't care about in which specific TileSet an image is so this\n * class holds them all and deals with the lookup.\n *\n * You don't usually create a `TileSets` instance yourself, instead\n * it is automatically created and attached to a `Map`.\n */\nvar TileSets = exports.TileSets = function(mapNode, mapUrl) {\n   var tileSets = [];\n\n   /**\n    * Retrieve the image for a tile ID (gid).\n    *\n    * @param {Number} gid global tile id to retrieve\n    * @returns {gamejs.graphics.Surface} the Surface for the gid\n    */\n   this.getSurface = function(gid) {\n      var tile = this.getTile(gid);\n      return tile && tile.surface || null;\n   };\n\n   /**\n    * @param {Number} gid global tile id\n    * @returns {Object} the custom properties of this tile\n    */\n   this.getProperties = function(gid) {\n      var tile = this.getTile(gid);\n      return tile && tile.properties || {};\n   };\n\n   /**\n    * @param {Number} gid global tile id\n    * @returns {Object} the Tile object for this gid\n    */\n   this.getTile = function(gid) {\n      var tile = null;\n      tileSets.some(function(tileSet, idx) {\n         if (tileSet.firstGid <= gid) {\n            tile = tileSet.tiles[gid - tileSet.firstGid];\n            return true;\n         }\n         return false;\n      }, this);\n      return tile;\n   };\n\n   var loadTileSet = function(tileSetNode) {\n      var tiles = [];\n      var tileWidth = tileSetNode.attribute('tilewidth');\n      var tileHeight = tileSetNode.attribute('tileheight');\n      var spacing = tileSetNode.attribute('spacing') || 0;\n      // broken in tiled?\n      var margin = 0;\n\n      var imageNode = tileSetNode.element('image');\n      var imageAtlasFile = imageNode.attribute('source');\n      var imageUrl = uri.makeRelative(uri.resolve(mapUrl, imageAtlasFile));\n      var atlas = gamejs.image.load(imageUrl);\n      // FIXME set transparency if imageNode.attribute('trans') is set\n\n      var tileNodes = tileSetNode.elements('tile');\n      var dims = atlas.getSize();\n      var imgSize = new gamejs.Rect([0,0], [tileWidth, tileHeight]);\n      var idx = 0;\n      var y = 0;\n      while (y + tileHeight <= dims[1]) {\n         var x = 0;\n         while (x + tileWidth <= dims[0]) {\n            var tileImage = new gamejs.graphics.Surface(tileWidth, tileHeight);\n            var rect = new gamejs.Rect([x, y], [tileWidth, tileHeight]);\n            tileImage.blit(atlas, imgSize, rect);\n            var tileProperties = {};\n            /* jshint ignore:start */\n            // function within loop\n            tileNodes.some(function(tileNode) {\n               if (tileNode.attribute('id') === idx) {\n                  setProperties(tileProperties, tileNode);\n                  return true;\n               }\n            }, this);\n            /* jshint ignore:end */\n            tiles.push({\n               surface: tileImage,\n               properties: tileProperties\n            });\n            x += tileWidth + spacing;\n            idx++;\n         }\n         y += tileHeight + spacing;\n      }\n      return tiles;\n   };\n\n   /**\n    *\n    * constructor\n    **/\n   mapNode.elements('tileset').forEach(function(tileSetNode) {\n      var firstGid = tileSetNode.attribute('firstgid');\n      var externalSource = tileSetNode.attribute('source');\n      if (externalSource) {\n         var tileSetDocument = xml.Document.fromURL(uri.resolve(mapUrl, externalSource));\n         tileSetNode = tileSetDocument.element('tileset');\n      }\n      tileSets.push({\n         tiles: loadTileSet(tileSetNode),\n         firstGid: firstGid\n      });\n   });\n   tileSets.reverse();\n\n   return this;\n};\n\n/**\n * loadLayers\n */\nvar H_FLIP = 0x80000000;\nvar V_FLIP = 0x40000000;\nvar loadLayers = function(mapNode) {\n   var layers = [];\n\n   var getGids = function(layerNode) {\n      var dataNode = layerNode.element('data');\n      var encoding = dataNode.attribute('encoding');\n      var compression = dataNode.attribute('compression');\n      var data = \"\";\n      dataNode.children().forEach(function(textNode) {\n         data += textNode.value();\n      });\n      var byteData = [];\n      if (encoding === 'base64') {\n         if (compression) {\n            throw new Error('Compression of map data unsupported');\n         }\n         byteData = base64.decodeAsArray(data, 4);\n      } else if (encoding === 'csv') {\n         data.trim().split('\\n').forEach(function(row) {\n            row.split(',', width).forEach(function(entry) {\n               byteData.push(parseInt(entry, 10));\n            });\n         });\n      } else {\n         // FIXME individual XML tile elements\n         throw new Error('individual tile format not supported');\n      }\n      return byteData;\n   };\n\n   var width = mapNode.attribute('width');\n   var height = mapNode.attribute('height');\n   mapNode.elements('layer').forEach(function(layerNode) {\n      // create empty gid matrix\n      var gidMatrix = [];\n      var i = height;\n      while (i-->0) {\n         var j = width;\n         gidMatrix[i] = [];\n         while (j-->0) {\n            gidMatrix[i][j] = 0;\n         }\n      }\n\n      getGids(layerNode).forEach(function(gid, idx) {\n         // FIXME flipX/Y currently ignored\n         var flipX = gid & H_FLIP;\n         var flipY = gid & V_FLIP;\n         // clear flags\n         gid &= ~(H_FLIP | V_FLIP);\n         gidMatrix[parseInt(idx / width, 10)][parseInt(idx % width, 10)] = gid;\n      });\n      layers.push({\n         gids: gidMatrix,\n         opacity: layerNode.attribute('opacity'),\n         visible: layerNode.attribute('visible'),\n         properties: setProperties({}, layerNode)\n      });\n   });\n   return layers;\n};\n\n/**\n * set generic <properties><property name=\"\" value=\"\">... on given object\n */\nvar setProperties = function(object, node) {\n   var props = node.element('properties');\n   if (!props) {\n      return;\n   }\n   props.elements('property').forEach(function(propertyNode) {\n      var name = propertyNode.attribute('name');\n      var value = propertyNode.attribute('value');\n      object[name] = value;\n   });\n   return object;\n};\n\n\n/**\n * FIXME explain viewRect (change it to sroll!) and image, mapImage and how to update, redraw\n */\nvar MapView = exports.MapView = function(map) {\n\n    this.timeout = 0;\n\n    this.layerViews = map.layers.map(function(layer) {\n      return new LayerView(layer, {\n         tileWidth: map.tileWidth,\n         tileHeight: map.tileHeight,\n         width: map.width,\n         height: map.height,\n         tiles: map.tiles\n      });\n    });\n    this.viewRect = new gamejs.Rect([0,0], [map.width * map.tileWidth, map.height*map.tileWidth]);\n    this.image = new gamejs.graphics.Surface([this.viewRect.width, this.viewRect.height]);\n    this.mapImage = this.image.clone();\n    this.redraw();\n    return this;\n};\n\nMapView.prototype.redraw = function() {\n    this.layerViews.forEach(function(layer) {\n        layer.draw(this.mapImage);\n    }, this);\n};\n\nMapView.prototype.draw = function(display, offset) {\n  display.blit(this.mapImage, offset || [0,0], this.viewRect);\n};\n\n\n\n/**\n * LayerView\n * Renders the layer to a big surface.\n */\nvar LayerView = exports.LayerView = function(layer, opts) {\n\n   this.draw = function(display) {\n      display.blit(this.surface);\n   };\n   /**\n    * constructor\n    */\n   this.surface = new gamejs.graphics.Surface(opts.width * opts.tileWidth, opts.height * opts.tileHeight);\n   this.surface.setAlpha(layer.opacity);\n\n   /**\n    * Note how below we look up the \"gid\" of the tile images in the TileSet from the Map\n    * ('opt.tiles') to get the actual Surfaces.\n    */\n   layer.gids.forEach(function(row, i) {\n      row.forEach(function(gid, j) {\n         if (gid ===0) {\n            return;\n         }\n\n         var tileSurface = opts.tiles.getSurface(gid);\n         if (tileSurface) {\n            this.surface.blit(tileSurface,\n               new gamejs.Rect([j * opts.tileWidth, i * opts.tileHeight], [opts.tileWidth, opts.tileHeight])\n            );\n         } else {\n            gamejs.log('no gid ', gid, i, j, 'layer', i);\n         }\n      }, this);\n   }, this);\n   return this;\n};\n\n","/**\n * @fileoverview\n * Only used by GameJs internally to provide a game loop.\n * @ignore\n */\n\nvar Callback = require('./utils/callback').Callback;\n\nvar TIMER_LASTCALL = null;\nvar STARTTIME = null;\n\n/** @ignore **/\nvar _CALLBACKS = exports._CALLBACKS = [];\n// `window` is not accessible in webworker (would lead to TypeError)\n// @@ this cross-browser fuckery has to go away ASAP.\nvar reqAnimationFrame = typeof(window) != 'undefined' ?\n                        window.requestAnimationFrame ||\n                        window.webkitRequestAnimationFrame ||\n                        window.mozRequestAnimationFrame ||\n                        window.oRequestAnimationFrame ||\n                        window.msRequestAnimationFrame ||\n                        null : null;\n\nvar reqAniFrameRecursive = function() {\n   perInterval();\n   reqAnimationFrame(reqAniFrameRecursive);\n};\n\nvar triggerCallbacks = function(msDuration) {\n   _CALLBACKS.forEach(function(c) {\n      c.trigger(msDuration);\n   });\n};\n\n/**\n * @ignore\n */\nexports.init = function() {\n   STARTTIME = Date.now();\n\n   if (reqAnimationFrame) {\n      reqAnimationFrame(reqAniFrameRecursive);\n   } else {\n      setInterval(perInterval, 10);\n   }\n   return;\n};\n\nvar perInterval = function() {\n   var msNow = Date.now();\n   triggerCallbacks(msNow - (TIMER_LASTCALL || msNow));\n   TIMER_LASTCALL = msNow;\n   return;\n};\n","var gamejs = require('../gamejs');\nvar objects = require('./utils/objects');\n\n/**\n * @fileoverview Image mask. Usefull for pixel perfect collision detection:\n *\n * @example\n * var unitMask = new Maks(unitSurface, collisionThresholdAlphaValue);\n * var spearMask = new Maks(unitSurface, collisionThresholdAlphaValue);\n * var collide = unitMask.overlap(spearMask);\n */\n\n\n/**\n * Creates an image mask from the given Surface. The alpha of each pixel is checked\n * to see if it is greater than the given threshold. If it is greater then\n * that pixel is set as not colliding.\n *\n * @param {Surface} surface used for image mask\n * @param {Number} threshold 0 to 255. defaults to: 255, fully transparent\n *\n */\nvar Mask = exports.Mask = function(surface, threshold) {\n   /**\n    * @ignore\n    */\n   this._bits = [];\n\n   threshold = (threshold && (255 - threshold)) || 255;\n   var imgData = surface.getImageData().data;\n   var dims = surface.getSize();\n   /**\n    * @ignore\n    */\n   this.width = dims[0];\n   /**\n    * @ignore\n    */\n   this.height = dims[1];\n\n   var i,j;\n   for (i=0;i<this.width;i++) {\n      this._bits[i] = [];\n      for (j=0;j<this.height;j++) {\n         this._bits[i][j] = false;\n      }\n   }\n   for (i=0;i<imgData.length;i += 4) {\n      // y: pixel # / width\n      var y = parseInt((i / 4) / dims[0], 10);\n      // x: pixel # % width\n      var x = parseInt((i / 4) % dims[0], 10);\n      var alpha = imgData[i+3];\n      if (alpha >= threshold) {\n         this.setAt(x, y);\n      }\n   }\n   return;\n};\n\n/**\n * @param {gamejs.mask.Mask} otherMask\n * @param {Array} offset [x,y]\n * @returns the overlapping rectangle or null if there is no overlap;\n */\nMask.prototype.overlapRect = function(otherMask, offset) {\n   var arect = this.rect;\n   var brect = otherMask.rect;\n   if (offset) {\n      brect.moveIp(offset);\n   }\n   // bounding box intersect\n   if (!brect.collideRect(arect)) {\n      return null;\n   }\n   var xStart = Math.max(arect.left, brect.left);\n   var xEnd = Math.min(arect.right, brect.right);\n\n   var yStart = Math.max(arect.top, brect.top);\n   var yEnd = Math.min(arect.bottom, brect.bottom);\n\n   return new gamejs.Rect([xStart, yStart], [xEnd - xStart, yEnd - yStart]);\n};\n\n/**\n *\n * @returns True if the otherMask overlaps with this map.\n * @param {Mask} otherMask\n * @param {Array} offset\n */\nMask.prototype.overlap = function(otherMask, offset) {\n   var overlapRect = this.overlapRect(otherMask, offset);\n   if (overlapRect === null) {\n      return false;\n   }\n\n   var arect = this.rect;\n   var brect = otherMask.rect;\n   if (offset) {\n      brect.moveIp(offset);\n   }\n\n   var count = 0;\n   var x,y;\n   for (y=overlapRect.top; y<=overlapRect.bottom; y++) {\n      for (x=overlapRect.left; x<=overlapRect.right; x++) {\n         if (this.getAt(x - arect.left, y - arect.top) &&\n             otherMask.getAt(x - brect.left, y - brect.top)) {\n             return true;\n         }\n      }\n   }\n   // NOTE this should not happen because either we bailed out\n   // long ago because the rects do not overlap or there is an\n   // overlap and we should not have gotten this far.\n   // throw new Error(\"Maks.overlap: overlap detected but could not create mask for it.\");\n   return false;\n};\n\n/**\n * @param {gamejs.mask.Mask} otherMask\n * @param {Array} offset [x,y]\n * @returns the number of overlapping pixels\n */\nMask.prototype.overlapArea = function(otherMask, offset) {\n   var overlapRect = this.overlapRect(otherMask, offset);\n   if (overlapRect === null) {\n      return 0;\n   }\n\n   var arect = this.rect;\n   var brect = otherMask.rect;\n   if (offset) {\n      brect.moveIp(offset);\n   }\n\n   var count = 0;\n   var x,y;\n   for (y=overlapRect.top; y<=overlapRect.bottom; y++) {\n      for (x=overlapRect.left; x<=overlapRect.right; x++) {\n         if (this.getAt(x - arect.left, y - arect.top) &&\n             otherMask.getAt(x - brect.left, y - brect.top)) {\n             count++;\n         }\n      }\n   }\n   return count;\n};\n\n/**\n * @param {gamejs.mask.Mask} otherMask\n * @param {Array} offset [x,y]\n * @returns a mask of the overlapping pixels\n */\nMask.prototype.overlapMask = function(otherMask, offset) {\n   var overlapRect = this.overlapRect(otherMask, offset);\n   if (overlapRect === null) {\n      return 0;\n   }\n\n   var arect = this.rect;\n   var brect = otherMask.rect;\n   if (offset) {\n      brect.moveIp(offset);\n   }\n\n   var mask = new Mask(new gamejs.graphics.Surface([overlapRect.width, overlapRect.height]));\n   var x,y;\n   for (y=overlapRect.top; y<=overlapRect.bottom; y++) {\n      for (x=overlapRect.left; x<=overlapRect.right; x++) {\n         if (this.getAt(x - arect.left, y - arect.top) &&\n             otherMask.getAt(x - brect.left, y - brect.top)) {\n             mask.setAt(x, y);\n         }\n      }\n   }\n   return mask;\n};\n\n/**\n * Set bit at position.\n * @param {Number} x\n * @param {Number} y\n */\nMask.prototype.setAt = function(x, y) {\n   this._bits[x][y] = true;\n};\n\n/**\n * Get bit at position.\n *\n * @param {Number} x\n * @param {Number} y\n */\nMask.prototype.getAt = function(x, y) {\n   x = parseInt(x, 10);\n   y = parseInt(y, 10);\n   if (x < 0 || y < 0 || x >= this.width || y >= this.height) {\n      return false;\n   }\n   return this._bits[x][y];\n};\n\n\n/**\n * Flip the bits in this map.\n */\nMask.prototype.invert = function() {\n   this._bits = this._bits.map(function(row) {\n      return row.map(function(b) {\n         return !b;\n      });\n   });\n};\n\n/**\n * @returns {Array} the dimensions of the map\n */\nMask.prototype.getSize = function() {\n   return [this.width, this.height];\n};\n\nobjects.accessors(Mask.prototype, {\n   /**\n    * Rect of this Mask.\n    */\n   'rect': {\n      get: function() {\n         return new gamejs.Rect([0, 0], [this.width, this.height]);\n      }\n   },\n   /**\n    * @returns {Number} number of set pixels in this mask.\n    */\n   'length': {\n      get: function() {\n         var c = 0;\n         this._bits.forEach(function(row) {\n            row.forEach(function(b) {\n               if (b) {\n                  c++;\n               }\n            });\n         });\n         return c;\n      }\n   }\n});\n"],"names":["require","objects","Callback","gamejs","exports","RESOURCES","thread","inWorker","ready","readyFn","_ready","init","getMixerProgress","getImageProgress","_readyResources","window","setTimeout","display","image","audio","event","math","random","time","document","body","preload","e","debug","errorModules","forEach","moduleName","toString","resources","uri","baseHref","$g","resourceBaseHref","location","href","res","resolve","this","onTick","fn","scope","_CALLBACKS","push","normalizeRectArguments","left","top","width","height","arguments","length","Array","Rect","Error","args","apply","accessors","prototype","bottom","get","set","newValue","right","center","topleft","bottomleft","topright","bottomright","x","y","move","moveIp","clip","rect","collideRect","union","Math","min","max","inflate","copy","clone","inflateIp","floor","collidePoint","collideLine","p1","p2","x1","y1","x2","y2","relPoses","map","point","noNegative","noPositive","noZero","relPos","join","font","http","graphics","logging","matrix","vectors","angles","binaryheap","noise","utils","arrays","strings","xml","base64","pathfinding","tiledmap","pixelcollision","identity","add","m1","m2","multiply","translate","dx","dy","rotate","angle","sin","cos","rotation","atan2","scale","svec","sx","sy","extend","subClass","superClass","undefined","F","Function","constructor","superConstructor","merge","i","property","result","obj","keys","Object","p","ret","hasOwnProperty","call","accessor","object","name","defineProperty","__defineGetter__","__defineSetter__","props","propKey","fnScope","trigger","_EVENTS","RESULT","ALIVE","LOG","importScripts","self","onmessage","_triggerCallbacks","data","postMessage","type","post","_logMessage","a","workerPrefix","__scripts","script","create","workerModuleId","moduleRoot","getModuleRoot","initialScripts","slice","getElementsByTagName","src","URL","webkitURL","prefixString","substring","indexOf","lastIndexOf","blob","Blob","blobURL","createObjectURL","Worker","moduleId","id","S4","guid","worker","deadQueue","alive","self1","_ERROR_CALLBACKS","triggerCallbacks","callbacks","c","log","concat","onerror","error","lineno","message","onEvent","onError","URI_REGEX","RegExp","path","m","match","n","host","absolutePath","charAt","lastSlashIndex","substr","removeDotSegments","makeRelative","docLocPath","pos","leadingSlash","segments","split","out","segment","pop","cb","callback","onFullscreen","DISPLAY_FULLSCREEN_ENABLED","DISPLAY_FULLSCREEN_DISABLED","onDisplayResize","DISPLAY_RESIZE","onMouseMotion","MOUSE_MOTION","onMouseUp","MOUSE_UP","onMouseDown","MOUSE_DOWN","onTouchMotion","TOUCH_MOTION","onTouchUp","TOUCH_UP","onTouchDown","TOUCH_DOWN","onKeyDown","KEY_DOWN","onKeyUp","KEY_UP","K_UP","K_DOWN","K_RIGHT","K_LEFT","K_SPACE","K_BACKSPACE","K_TAB","K_ENTER","K_SHIFT","K_CTRL","K_ALT","K_ESC","K_0","K_1","K_2","K_3","K_4","K_5","K_6","K_7","K_8","K_9","K_a","K_b","K_c","K_d","K_e","K_f","K_g","K_h","K_i","K_j","K_k","K_l","K_m","K_n","K_o","K_p","K_q","K_r","K_s","K_t","K_u","K_v","K_w","K_x","K_y","K_z","K_KP1","K_KP2","K_KP3","K_KP4","K_KP5","K_KP6","K_KP7","K_KP8","K_KP9","NOEVENT","NUMEVENTS","QUIT","MOUSE_WHEEL","USEREVENT","Event","key","rel","button","lastPos","onMouseScroll","ev","canvasOffset","_getCanvasOffset","currentPos","clientX","clientY","delta","detail","wheelDeltaY","w3cTouchConvert","touchList","tList","touchEvent","item","identifier","changedTouches","touches","canvas","_getCanvas","addEventListener","shiftKey","ctrlKey","metaKey","keyCode","which","_hasFocus","preventDefault","relativePos","buttons","timestamp","timeStamp","movement","movementX","mozMovementX","webkitMovementX","movementY","mozMovementY","webkitMovementY","Surface","CANVAS_ID","SURFACE","DISABLE_SMOOTHING","FULLSCREEN","POINTERLOCK","_flags","getCanvas","displayCanvas","getElementById","createElement","setAttribute","appendChild","fullScreenChange","gjsEvent","isFullScreen","enablePointerLock","onResize","_canvas","clientWidth","clientHeight","hasPointerLock","pointerLockElement","webkitFullscreenElement","mozFullscreenElement","mozFullScreenElement","getAttribute","focus","$loader","style","$displaySurface","isFullscreen","fullScreenElement","mozFullScreen","webkitIsFullScreen","webkitDisplayingFullscreen","enableFullScreen","wrapper","requestFullScreen","mozRequestFullScreen","webkitRequestFullScreen","Element","ALLOW_KEYBOARD_INPUT","requestPointerLock","mozRequestPointerLock","webkitRequestPointerLock","activeElement","setMode","dimensions","flags","fullScreenToggle","fullScreenButton","innerHTML","parentNode","insertBefore","getFullScreenToggle","removeEventListener","getSurface","setCaption","title","icon","_isSmoothingEnabled","boundRect","getBoundingClientRect","_context","getContext","_noSmooth","_smooth","_matrix","_blitAlpha","context","mozImageSmoothingEnabled","webkitImageSmoothingEnabled","blit","dest","area","compositeOperation","rDest","rArea","srcSize","getSize","size","isNaN","save","globalCompositeOperation","globalAlpha","drawImage","restore","getRect","fill","color","fillStyle","fillRect","clear","clearRect","newSurface","getAlpha","setAlpha","alpha","getImageData","line","surface","startPos","endPos","ctx","beginPath","strokeStyle","lineWidth","moveTo","lineTo","stroke","lines","closed","pointlist","idx","circle","radius","arc","PI","strokeRect","startAngle","stopAngle","polygon","closePath","quadraticCurve","controlPos","quadraticCurveTo","bezierCurve","ct1Pos","ct2Pos","bezierCurveTo","origSize","radians","newSize","rotPoints","xs","ys","offset","transform","dims","oldDims","ws","hs","flip","flipHorizontal","flipVertical","scaleX","scaleY","xPos","yPos","blitArray","surfaceArray","putImageData","imageData","SurfaceArray","surfaceOrDimensions","rgba","s","createImageData","distance","b","len","subtract","divide","v","sqrt","unit","l","normaliseRadians","dot","v1","v2","perpDot","truncate","maxLength","centroid","parseInt","normaliseDegrees","degrees","Font","fontSettings","backgroundColor","sampleSurface","textAlign","textBaseline","render","text","fillText","measureText","fontHeight","Response","getResponseHeader","header","ajax","method","url","response","XMLHttpRequest","open","setRequestHeader","JSON","stringify","send","eval","responseText","ajaxBaseHref","load","payload","CACHE","img","naturalWidth","naturalHeight","imgIdents","countLoaded","countTotal","incrementLoaded","successHandler","addToCache","errorHandler","lowerKey","toLowerCase","Image","gamejsKey","_PRELOADING","NUM_CHANNELS","audios","setNumChannels","count","getNumChannels","audioUrls","showProgressOrImage","Audio","isPreloading","Sound","uriOrAudio","cachedAudio","channels","loop","play","some","ended","paused","stop","setVolume","value","volume","getVolume","getLength","duration","DEBUG_LEVELS","debugLevel","setLogLevel","logLevel","unshift","Date","now","console","info","warn","fatal","BinaryHeap","scoreFunction","content","element","sinkDown","end","bubbleUp","remove","node","cNode","parentIdx","parent","elemScore","child1Score","child2Idx","child1Idx","swapIdx","child1","child2","Mash","hash","h","charCodeAt","version","Alea","s0","s1","s2","mash","t","integer","vector","choose","items","alea","seed","Simplex","r","grad3","perm","simplex","g","xin","yin","i1","j1","j","G2","x0","y0","ii","jj","gi0","gi1","gi2","t0","t1","t2","get3d","zin","k1","i2","j2","k2","k","G3","z0","z1","z2","x3","y3","z3","kk","gi3","t3","array","splice","shuffle","getCommonPrefix","str1","str2","Parser","parser","DOMParser","parseFromString","xmlString","Document","xmlDocument","XMLDocument","_xmlDocument","elem","elements","elems","attribute","attributeValue","trim","attributeIntValue","attributeFloatValue","parseFloat","nodeValue","children","childNodes","fromString","xmlDoc","fromURL","overrideMimeType","responseXML","keyStr","decode","input","chr1","chr2","chr3","enc2","enc3","enc4","output","replace","String","fromCharCode","decodeAsArray","bytes","decoded","ReachedList","hashFn","list","store","route","find","findRoute","from","to","timeout","score","estimatedDistance","reached","defaultHash","addOpenRoute","processNewPoints","direction","known","newLength","actualDistance","startMs","equalsFn","equals","defaultEquals","adjacent","Map","origin","pointA","pointB","TileSets","mapNode","tileWidth","tileHeight","properties","setProperties","tiles","layers","loadLayers","Tile","mapUrl","tileSets","gid","tile","getTile","getProperties","tileSet","firstGid","loadTileSet","tileSetNode","spacing","imageAtlasFile","imageUrl","atlas","tileNodes","imgSize","tileImage","tileProperties","tileNode","externalSource","reverse","layerNode","gidMatrix","dataNode","encoding","compression","textNode","byteData","row","entry","getGids","gids","opacity","visible","propertyNode","MapView","layerViews","layer","LayerView","viewRect","mapImage","redraw","draw","opts","tileSurface","TIMER_LASTCALL","reqAnimationFrame","requestAnimationFrame","webkitRequestAnimationFrame","mozRequestAnimationFrame","oRequestAnimationFrame","msRequestAnimationFrame","reqAniFrameRecursive","perInterval","setInterval","msDuration","msNow","Mask","threshold","_bits","imgData","setAt","overlapRect","otherMask","arect","brect","xStart","xEnd","yStart","yEnd","overlap","getAt","overlapArea","overlapMask","mask","invert"],"version":3,"file":"index.55a7195a.js.map"}